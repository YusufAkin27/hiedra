import{e,u as s,r as i,j as r,L as a}from"./react-vendor-DfawjiNX.js";import{a as t}from"./context-BBxaqZSG.js";import{S as n}from"./SEO-COBDhSYn.js";import"./vendor-invariant-GfE-dftQ.js";import"./vendor-shallowequal-DDPVF0Lr.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BfCtOoOM.js";const l="http://localhost:8080/api",d=()=>{const{orderNumber:d}=e(),{user:c,isAuthenticated:o,accessToken:m}=t(),h=s(),[u,p]=i.useState(null),[g,x]=i.useState(!0),[j,N]=i.useState(""),[b,k]=i.useState(!1),[v,y]=i.useState("Ä°ade talebi"),[E,f]=i.useState(!1),[S,D]=i.useState(""),[A,T]=i.useState(null),[w,R]=i.useState(!1);i.useEffect(()=>{o?d&&C():h("/giris")},[d,o,m]);const C=async()=>{if(!c?.email||!d)return N("KullanÄ±cÄ± bilgisi veya sipariÅŸ numarasÄ± bulunamadÄ±"),void x(!1);try{x(!0),N(""),D("");const e=await fetch(l+"/orders/query",{method:"POST",headers:{"Content-Type":"application/json",...m&&{Authorization:"Bearer "+m}},body:JSON.stringify({orderNumber:d,customerEmail:c.email})});if(!e.ok){if(401===e.status)throw Error("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n.");if(404===e.status)throw Error("SipariÅŸ bulunamadÄ±.");{const s=await e.json().catch(()=>({}));throw Error(s.message||`SipariÅŸ yÃ¼klenemedi (${e.status})`)}}const s=await e.json();if(!s.isSuccess&&!s.success)throw Error(s.message||"SipariÅŸ yÃ¼klenemedi");{const e=s.data||s;p({...e,shippingAddress:e.addresses&&e.addresses.length>0?e.addresses[0]:{}}),e.trackingNumber&&I(e.trackingNumber,e.orderNumber)}}catch(e){N(e.message||"SipariÅŸ yÃ¼klenirken bir hata oluÅŸtu")}finally{x(!1)}},I=async(e,s)=>{if(e&&c?.email)try{R(!0);const e=new URL(l+"/shipping/track-by-order");e.searchParams.append("orderNumber",s),e.searchParams.append("email",c.email);const i=await fetch(e.toString(),{method:"GET",headers:{"Content-Type":"application/json",...m&&{Authorization:"Bearer "+m}}}),r=await i.json();(r.isSuccess||r.success)&&T(r.data)}catch(i){}finally{R(!1)}},F=e=>{if(!e)return"";try{return new Date(e).toLocaleString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}};return o?r.jsxs("div",{className:"order-detail-container",children:[r.jsx(n,{title:`SipariÅŸ DetayÄ± - ${d} - Hiedra Perde`,description:d+" numaralÄ± sipariÅŸinizin detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyin",url:"/siparis/"+d}),g?r.jsxs("div",{className:"loading-state",children:[r.jsx("div",{className:"loading-spinner"}),r.jsx("p",{children:"SipariÅŸ yÃ¼kleniyor..."})]}):j&&!u?r.jsxs("div",{className:"error-state",children:[r.jsx("p",{children:j}),r.jsxs("div",{className:"action-buttons",children:[r.jsx("button",{onClick:C,className:"retry-btn",children:"Tekrar Dene"}),r.jsx(a,{to:"/siparislerim",className:"back-btn",children:"SipariÅŸlerime DÃ¶n"})]})]}):u?r.jsxs(r.Fragment,{children:[r.jsxs("header",{className:"order-detail-header",children:[r.jsxs("div",{className:"header-content",children:[r.jsx(a,{to:"/siparislerim",className:"back-link",children:"â† SipariÅŸlerime DÃ¶n"}),r.jsx("h1",{children:"SipariÅŸ DetayÄ±"})]}),(()=>{if(!u||!u.status)return!1;const e=u.status.toUpperCase();return"REFUNDED"!==e&&"REFUND_REQUESTED"!==e})()&&r.jsx("button",{onClick:()=>k(!0),className:"refund-request-btn",disabled:E,children:"Ä°ade Talebi OluÅŸtur"})]}),j&&r.jsx("div",{className:"error-message",children:j}),S&&r.jsx("div",{className:"success-message",children:S}),r.jsxs("div",{className:"order-detail-content",children:[r.jsx("div",{className:"order-summary-card",children:r.jsxs("div",{className:"summary-header",children:[r.jsxs("div",{className:"order-info",children:[r.jsxs("h2",{children:["SipariÅŸ No: ",u.orderNumber]}),r.jsx("span",{className:"status-badge "+(e=>{if(!e)return"status-unknown";const s=e.toUpperCase();return"DELIVERED"===s?"status-delivered":"SHIPPED"===s?"status-shipped":"PROCESSING"===s||"PAID"===s?"status-processing":"CANCELLED"===s||"REFUNDED"===s?"status-cancelled":"REFUND_REQUESTED"===s?"status-refund":"status-pending"})(u.status),children:(L=u.status,L?{PENDING:"Beklemede",PAID:"Ã–dendi",PROCESSING:"HazÄ±rlanÄ±yor",SHIPPED:"Kargoya Verildi",DELIVERED:"Teslim Edildi",CANCELLED:"Ä°ptal Edildi",REFUNDED:"Ä°ade Edildi",REFUND_REQUESTED:"Ä°ade Talebi"}[L.toUpperCase()]||L:"Bilinmiyor")})]}),r.jsxs("div",{className:"order-date",children:[r.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("polyline",{points:"12 6 12 12 16 14"})]}),u.createdAt?new Date(u.createdAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Tarih bilgisi yok"]})]})}),r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"SipariÅŸ ÃœrÃ¼nleri"}),r.jsx("div",{className:"order-items-list",children:u.orderItems&&u.orderItems.length>0?u.orderItems.map((e,s)=>{const i=e.price?"string"==typeof e.price?parseFloat(e.price):parseFloat(e.price.toString()):0;return r.jsxs("div",{className:"order-item-detail",children:[r.jsxs("div",{className:"item-main-info",children:[r.jsx("h4",{children:e.productName||"ÃœrÃ¼n"}),r.jsxs("div",{className:"item-specs",children:[e.width&&e.height&&r.jsxs("span",{className:"spec-item",children:[r.jsx("strong",{children:"Ã–lÃ§Ã¼ler:"})," ",e.width," x ",e.height," cm"]}),e.pleatType&&"1x1"!==e.pleatType&&r.jsxs("span",{className:"spec-item",children:[r.jsx("strong",{children:"Pile Tipi:"})," ",e.pleatType]}),r.jsxs("span",{className:"spec-item",children:[r.jsx("strong",{children:"Adet:"})," ",e.quantity||1]})]})]}),r.jsx("div",{className:"item-price-info",children:r.jsxs("span",{className:"item-price",children:[i.toFixed(2)," â‚º"]})})]},e.id||s)}):r.jsx("p",{children:"SipariÅŸ detayÄ± bulunamadÄ±"})}),r.jsxs("div",{className:"order-total-section",children:[r.jsxs("div",{className:"total-row",children:[r.jsx("span",{children:"Ara Toplam:"}),r.jsxs("span",{children:[u.totalAmount?"string"==typeof u.totalAmount?parseFloat(u.totalAmount).toFixed(2):parseFloat(u.totalAmount.toString()).toFixed(2):"0.00"," â‚º"]})]}),r.jsxs("div",{className:"total-row final",children:[r.jsx("span",{children:"Toplam:"}),r.jsxs("span",{className:"total-amount",children:[u.totalAmount?"string"==typeof u.totalAmount?parseFloat(u.totalAmount).toFixed(2):parseFloat(u.totalAmount.toString()).toFixed(2):"0.00"," â‚º"]})]})]})]}),r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"Teslimat Adresi"}),r.jsxs("div",{className:"address-details",children:[u.shippingAddress&&r.jsxs(r.Fragment,{children:[u.shippingAddress.addressLine&&r.jsxs("p",{children:[r.jsx("strong",{children:"Adres:"})," ",u.shippingAddress.addressLine]}),u.shippingAddress.addressDetail&&r.jsxs("p",{children:[r.jsx("strong",{children:"Adres DetayÄ±:"})," ",u.shippingAddress.addressDetail]}),(u.shippingAddress.district||u.shippingAddress.city)&&r.jsxs("p",{children:[r.jsx("strong",{children:"Ä°lÃ§e/Åehir:"})," ",u.shippingAddress.district||"",u.shippingAddress.district&&u.shippingAddress.city?" / ":"",u.shippingAddress.city||""]})]}),(!u.shippingAddress||!u.shippingAddress.addressLine&&!u.shippingAddress.city)&&r.jsx("p",{children:"Adres bilgisi bulunamadÄ±"})]})]}),u.trackingNumber&&r.jsxs("div",{className:"order-section tracking-section",children:[r.jsx("h3",{children:"Kargo Takip Bilgileri"}),r.jsxs("div",{className:"tracking-info-card",children:[r.jsxs("div",{className:"tracking-header-info",children:[r.jsxs("div",{className:"tracking-number-info",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Takip NumarasÄ±:"})," ",u.trackingNumber]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Kargo FirmasÄ±:"})," ",u.carrier||"DHL"]}),u.shippedAt&&r.jsxs("p",{children:[r.jsx("strong",{children:"Kargoya Verilme:"})," ",new Date(u.shippedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[r.jsx("button",{onClick:()=>I(u.trackingNumber,u.orderNumber),disabled:w,style:{padding:"0.5rem 1rem",background:w?"#ccc":"#667eea",color:"white",border:"none",borderRadius:"4px",cursor:w?"not-allowed":"pointer",fontSize:"0.9rem",opacity:w?.6:1},children:w?"YÃ¼kleniyor...":"ğŸ”„ GÃ¼ncelle"}),r.jsx(a,{to:`/kargo-takip?trackingNumber=${u.trackingNumber}&orderNumber=${u.orderNumber}`,className:"track-shipment-link",children:"ğŸ“¦ DetaylÄ± Takip"})]})]}),w?r.jsx("div",{className:"tracking-loading",children:r.jsx("p",{children:"Kargo bilgileri yÃ¼kleniyor..."})}):A?r.jsxs("div",{className:"tracking-details",children:[r.jsxs("div",{className:"tracking-status-badge",children:[r.jsx("div",{className:"status-badge "+(e=>{if(!e)return"tracking-status-unknown";const s=e.toUpperCase();return"DELIVERED"===s?"tracking-status-delivered":"IN_TRANSIT"===s||"OUT_FOR_DELIVERY"===s?"tracking-status-transit":"EXCEPTION"===s?"tracking-status-exception":"tracking-status-pending"})(A.status),children:(e=>e?{IN_TRANSIT:"Kargoda",DELIVERED:"Teslim Edildi",EXCEPTION:"Sorun Var",PENDING:"Beklemede",PICKED_UP:"Kargo AlÄ±ndÄ±",OUT_FOR_DELIVERY:"Teslimat Ä°Ã§in Yola Ã‡Ä±ktÄ±"}[e]||e:"Bilinmiyor")(A.status)}),A.statusDescription&&r.jsx("p",{className:"status-description",children:A.statusDescription})]}),A.events&&A.events.length>0&&r.jsxs("div",{className:"tracking-events-preview",children:[r.jsx("h4",{children:"Son Hareketler"}),r.jsxs("div",{className:"events-list",children:[A.events.slice(0,3).map((e,s)=>r.jsxs("div",{className:"event-preview-item",children:[r.jsx("div",{className:"event-time-small",children:F(e.timestamp)}),r.jsxs("div",{className:"event-content-small",children:[e.location&&r.jsx("span",{className:"location-icon",children:"ğŸ“"}),r.jsx("span",{children:e.location||"Konum bilgisi yok"})]}),e.description&&r.jsx("div",{className:"event-description-small",children:e.description})]},s)),A.events.length>3&&r.jsxs(a,{to:`/kargo-takip?trackingNumber=${u.trackingNumber}&orderNumber=${u.orderNumber}`,className:"view-all-events-link",children:["TÃ¼m hareketleri gÃ¶rÃ¼ntÃ¼le (",A.events.length," adet)"]})]})]})]}):r.jsxs("div",{className:"tracking-no-data",children:[r.jsx("p",{children:'Kargo takip bilgisi henÃ¼z gÃ¼ncellenmedi. "GÃ¼ncelle" butonuna tÄ±klayarak en gÃ¼ncel bilgileri alabilirsiniz.'}),r.jsx("button",{onClick:()=>I(u.trackingNumber,u.orderNumber),disabled:w,style:{marginTop:"0.5rem",padding:"0.5rem 1rem",background:w?"#ccc":"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:w?"not-allowed":"pointer",fontSize:"0.9rem",opacity:w?.6:1},children:w?"YÃ¼kleniyor...":"Kargo Bilgisini YÃ¼kle"})]})]})]}),r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"MÃ¼ÅŸteri Bilgileri"}),r.jsxs("div",{className:"customer-details",children:[u.customerName&&r.jsxs("p",{children:[r.jsx("strong",{children:"Ad Soyad:"})," ",u.customerName]}),u.customerEmail&&r.jsxs("p",{children:[r.jsx("strong",{children:"E-posta:"})," ",u.customerEmail]}),u.customerPhone&&r.jsxs("p",{children:[r.jsx("strong",{children:"Telefon:"})," ",u.customerPhone]})]})]}),u.cancelReason&&r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"Ä°ptal Bilgisi"}),r.jsxs("div",{className:"cancel-info",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Sebep:"})," ",u.cancelReason]}),u.cancelledAt&&r.jsxs("p",{children:[r.jsx("strong",{children:"Ä°ptal Tarihi:"})," ",new Date(u.cancelledAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),u.refundedAt&&r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"Ä°ade Bilgisi"}),r.jsx("div",{className:"refund-info",children:r.jsxs("p",{children:[r.jsx("strong",{children:"Ä°ade Tarihi:"})," ",new Date(u.refundedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})})]}),"REFUND_REQUESTED"===u.status&&r.jsxs("div",{className:"order-section info-section",children:[r.jsx("h3",{children:"Ä°ade Talebi"}),r.jsx("div",{className:"refund-request-info",children:r.jsx("p",{children:"Ä°ade talebiniz alÄ±nmÄ±ÅŸtÄ±r ve deÄŸerlendirme aÅŸamasÄ±ndadÄ±r. En kÄ±sa sÃ¼rede size geri dÃ¶nÃ¼ÅŸ yapÄ±lacaktÄ±r."})})]})]}),b&&r.jsx("div",{className:"modal-overlay",onClick:()=>!E&&k(!1),children:r.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[r.jsx("h3",{children:"Ä°ade Talebi OluÅŸtur"}),r.jsx("p",{children:"Ä°ade talebi oluÅŸturmak istediÄŸinizden emin misiniz? Ä°ade talebiniz deÄŸerlendirildikten sonra size geri dÃ¶nÃ¼ÅŸ yapÄ±lacaktÄ±r."}),r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{htmlFor:"refundReason",children:["Ä°ade Sebebi ",r.jsx("span",{className:"required",children:"*"})]}),r.jsx("textarea",{id:"refundReason",value:v,onChange:e=>y(e.target.value),rows:"4",placeholder:"LÃ¼tfen iade sebebinizi detaylÄ± olarak aÃ§Ä±klayÄ±n...",required:!0})]}),r.jsxs("div",{className:"modal-actions",children:[r.jsx("button",{onClick:()=>{k(!1),y("Ä°ade talebi"),N("")},disabled:E,className:"cancel-btn",children:"Ä°ptal"}),r.jsx("button",{onClick:async()=>{if(v.trim()){f(!0),N(""),D("");try{const e=await fetch(`${l}/orders/${d}/refund?email=${encodeURIComponent(c.email)}&reason=${encodeURIComponent(v)}`,{method:"POST",headers:{"Content-Type":"application/json",...m&&{Authorization:"Bearer "+m}}}),s=await e.json();if(!e.ok)throw Error(s.message||"Ä°ade talebi oluÅŸturulamadÄ±");if(!s.isSuccess&&!s.success)throw Error(s.message||"Ä°ade talebi oluÅŸturulamadÄ±");D("Ä°ade talebiniz baÅŸarÄ±yla oluÅŸturuldu. En kÄ±sa sÃ¼rede deÄŸerlendirilecektir."),k(!1),y("Ä°ade talebi"),await C()}catch(e){N(e.message||"Ä°ade talebi oluÅŸturulurken bir hata oluÅŸtu")}finally{f(!1)}}else N("LÃ¼tfen iade sebebini belirtin")},disabled:E||!v.trim(),className:"confirm-btn",children:E?"Ä°ÅŸleniyor...":"Ä°ade Talebi OluÅŸtur"})]})]})})]}):null]}):null;var L};export{d as default};
