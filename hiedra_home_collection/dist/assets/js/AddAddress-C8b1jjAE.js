import{u as e,r as s,j as a,L as i}from"./react-vendor-2SZXphvN.js";import{a as r}from"./context-DM-lvtsQ.js";import{u as l}from"./index-Cy34ZEl5.js";import{S as n}from"./SEO-BxBC3DWO.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";const t="http://localhost:8080/api",d=()=>{const{isAuthenticated:d,accessToken:o}=r(),c=e(),m=l(),[u,h]=s.useState({fullName:"",phone:"",addressLine:"",addressDetail:"",city:"",district:"",isDefault:!1}),[p,x]=s.useState(!1),[j,f]=s.useState(""),[y,k]=s.useState(!1),[g,N]=s.useState(!1);s.useEffect(()=>{d||c("/giris",{state:{from:"/adres-ekle"}})},[d,c]),s.useEffect(()=>{d&&o&&!g&&v()},[d,o,g]);const v=async()=>{try{const e=await fetch(t+"/user/profile",{headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();if(s.success&&s.data){const e=s.data;(e.fullName||e.phone)&&h(s=>({...s,fullName:e.fullName||s.fullName,phone:e.phone||s.phone})),N(!0)}}}catch(e){N(!0)}},b=e=>{const{name:s,value:a,type:i,checked:r}=e.target;h(e=>({...e,[s]:"checkbox"===i?r:a}))};return d?a.jsxs("div",{className:"add-address-page",children:[a.jsx(n,{title:"Yeni Adres Ekle - Hiedra Home Collection",description:"Yeni teslimat adresi ekleyin",url:"/adres-ekle"}),a.jsxs("div",{className:"add-address-container",children:[a.jsxs("div",{className:"add-address-header",children:[a.jsxs(i,{to:"/adreslerim",className:"back-link",children:[a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Adreslerime Dön"]}),a.jsx("h1",{children:"Yeni Adres Ekle"}),a.jsx("p",{className:"page-subtitle",children:"Teslimat için yeni bir adres ekleyin"}),a.jsxs("div",{className:"location-button-container",children:[a.jsx("button",{type:"button",onClick:async()=>{if(navigator.geolocation){k(!0),f("");try{navigator.geolocation.getCurrentPosition(async e=>{const{latitude:s,longitude:a,accuracy:i}=e.coords;i&&i>100&&m.warning(`Konum hassasiyeti düşük (±${Math.round(i)}m). Daha doğru sonuç için açık alanda tekrar deneyin.`);try{const e=await fetch(`${t}/geocoding/reverse?latitude=${s}&longitude=${a}`),i=await e.json();if(!(e.ok&&i.success&&i.data))throw Error(i.message||"Adres bilgisi alınamadı");{const e=i.data;h(s=>{let a=e.city||s.city,i=e.district||s.district;if(e.displayName){const s=e.displayName.split(",").map(e=>e.trim());if(s.length>=3&&(s[2]&&(a=s[2]),!i&&s[1])){let e=s[1];a&&e.includes(a)&&(e=e.replace(a,"").trim(),""!==e&&"merkez"!==e.toLowerCase()||(e="Merkez")),i=e}}if(a&&(a.toLowerCase().includes("merkez")&&(a=a.replace(/\s*merkez\s*/i,"").trim()),i&&a.includes(i)&&(a=a.replace(i,"").trim())),i&&a&&i.includes(a)){const e=i.replace(a,"").trim();i=""===e||"merkez"===e.toLowerCase()?"Merkez":e}const r=[];e.road&&r.push(e.road),e.houseNumber&&r.push("No: "+e.houseNumber);let l=s.addressLine;if(r.length>0)l=r.join(", ");else if(e.displayName){const s=e.displayName.split(",");s.length>1&&(l=s[0].trim())}return{...s,city:a,district:i,addressLine:l}}),m.success("Konumunuzdan adres bilgileri alındı. Lütfen kontrol edin ve gerekirse düzenleyin.")}}catch(r){m.error("Adres bilgisi alınırken bir hata oluştu. Lütfen manuel olarak girin.")}finally{k(!1)}},e=>{let s="Konum alınamadı.";switch(e.code){case e.PERMISSION_DENIED:s="Konum izni reddedildi. Lütfen tarayıcı ayarlarından konum iznini açın.";break;case e.POSITION_UNAVAILABLE:s="Konum bilgisi alınamadı.";break;case e.TIMEOUT:s="Konum alınırken zaman aşımı oluştu."}m.error(s),k(!1)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}catch(e){m.error("Konum servisi kullanılamıyor."),k(!1)}}else m.error("Tarayıcınız konum özelliğini desteklemiyor.")},disabled:y,className:"location-button-primary",children:y?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"loading-spinner"}),"Konumunuz alınıyor..."]}):a.jsxs(a.Fragment,{children:[a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),a.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),"Konumumdan Adres Bilgilerini Al"]})}),a.jsx("p",{className:"location-hint",children:"Konum izni vererek adres bilgilerinizi otomatik doldurabilirsiniz"})]})]}),j&&a.jsx("div",{className:"alert alert-error",children:j}),a.jsx("div",{className:"add-address-form-wrapper",children:a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),f(""),x(!0);try{const e=await fetch(t+"/user/addresses",{method:"POST",headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"},body:JSON.stringify({...u})}),s=await e.json();e.ok&&(s.isSuccess||s.success)?(m.success("Adres başarıyla eklendi."),c("/adreslerim")):f(s.message||"Adres eklenemedi")}catch(s){f("Adres eklenirken bir hata oluştu")}finally{x(!1)}},className:"add-address-form",children:[a.jsxs("div",{className:"form-section",children:[a.jsx("h2",{className:"form-section-title",children:"Kişi Bilgileri"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"fullName",children:"Ad Soyad *"}),a.jsx("input",{type:"text",id:"fullName",name:"fullName",value:u.fullName,onChange:b,required:!0,placeholder:"Adınız ve soyadınız"}),a.jsx("p",{className:"form-hint",children:"Kişisel bilgilerinizi kontrol edin"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"phone",children:"Telefon *"}),a.jsx("input",{type:"tel",id:"phone",name:"phone",value:u.phone,onChange:b,required:!0,placeholder:"05XX XXX XX XX"})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h2",{className:"form-section-title",children:"Adres Bilgileri"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"addressLine",children:"Sokak / Cadde / Bina No *"}),a.jsx("input",{type:"text",id:"addressLine",name:"addressLine",value:u.addressLine,onChange:b,required:!0,placeholder:"Sokak, cadde ve bina numarası"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"addressDetail",children:"Adres Detayı"}),a.jsx("input",{type:"text",id:"addressDetail",name:"addressDetail",value:u.addressDetail,onChange:b,placeholder:"Daire, kat, blok vb. (opsiyonel)"})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"city",children:"İl *"}),a.jsx("input",{type:"text",id:"city",name:"city",value:u.city,onChange:b,required:!0,placeholder:"İl adı"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"district",children:"İlçe *"}),a.jsx("input",{type:"text",id:"district",name:"district",value:u.district,onChange:b,required:!0,placeholder:"İlçe adı"})]})]})]}),a.jsx("div",{className:"form-section",children:a.jsx("div",{className:"form-group checkbox-group",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",name:"isDefault",checked:u.isDefault,onChange:b}),a.jsx("span",{children:"Varsayılan adres olarak ayarla"})]})})}),a.jsxs("div",{className:"form-actions",children:[a.jsx(i,{to:"/adreslerim",className:"btn-cancel",children:"İptal"}),a.jsx("button",{type:"submit",className:"btn-submit",disabled:p,children:p?"Kaydediliyor...":"Adresi Kaydet"})]})]})})]})]}):null};export{d as default};
