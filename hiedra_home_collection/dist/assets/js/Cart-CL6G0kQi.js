import{u as e,r as s,j as a,L as i}from"./react-vendor-2SZXphvN.js";import{u as t,a as n}from"./context-DM-lvtsQ.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";const c="http://localhost:8080/api",l=()=>{const{cartItems:l,removeFromCart:r,updateQuantity:o,clearCart:d,getCartTotal:m,getCartSubtotal:u,refreshCart:h,discountAmount:p,couponCode:x,setDiscountAmount:j,setCouponCode:y}=t(),{accessToken:N,isAuthenticated:v}=n(),g=e(),[b,k]=s.useState(""),[z,f]=s.useState(!1),[C,w]=s.useState(!1),[S,I]=s.useState(""),[K,q]=s.useState("");s.useEffect(()=>{h()},[]);const A=async()=>{if(b.trim())if(v)try{f(!0),I(""),q("");let e=null;v&&N||(e=localStorage.getItem("guestUserId"));const s=`${c}/cart/apply-coupon${e?"?guestUserId="+e:""}`,a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...N&&{Authorization:"Bearer "+N}},body:JSON.stringify({couponCode:b.trim().toUpperCase()})}),i=await a.json();a.ok&&(i.isSuccess||i.success)?(q("Kupon baÅŸarÄ±yla uygulandÄ±!"),k(""),await h()):I(i.message||"Kupon uygulanamadÄ±")}catch(e){I("Kupon uygulanÄ±rken bir hata oluÅŸtu")}finally{f(!1)}else I("Kupon uygulamak iÃ§in lÃ¼tfen giriÅŸ yapÄ±nÄ±z");else I("LÃ¼tfen kupon kodunu giriniz")},T=async(e,s=null,a=null)=>{try{if(a&&s&&s.startsWith("backend_")){let e=null;v&&N||(e=localStorage.getItem("guestUserId"));const s=`${c}/cart/items/${a}${e?"?guestUserId="+e:""}`;if((await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json",...N&&{Authorization:"Bearer "+N}}})).ok)return void(await h())}r(e,s)}catch(i){r(e,s)}},B=async(e,s,a=null,i=null)=>{if(s>0)try{if(i&&a&&a.startsWith("backend_")){let e=null;v&&N||(e=localStorage.getItem("guestUserId"));const a=`${c}/cart/items/${i}${e?"?guestUserId="+e:""}`;if((await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json",...N&&{Authorization:"Bearer "+N}},body:JSON.stringify({quantity:s})})).ok)return void(await h())}o(e,s,a)}catch(t){o(e,s,a)}else T(e,a,i)};return 0===l.length?a.jsx("div",{className:"cart-container",children:a.jsxs("div",{className:"empty-cart",children:[a.jsx("div",{className:"empty-cart-icon",children:"ğŸ›’"}),a.jsx("h2",{children:"Sepetiniz BoÅŸ"}),a.jsx("p",{children:"AlÄ±ÅŸveriÅŸe baÅŸlamak iÃ§in Ã¼rÃ¼nlerimizi inceleyin"}),a.jsx(i,{to:"/",className:"shop-btn",children:"AlÄ±ÅŸveriÅŸe BaÅŸla"})]})}):a.jsxs("div",{className:"cart-container",children:[a.jsxs("div",{className:"cart-header",children:[a.jsx("h1",{children:"Sepetim"}),a.jsxs("p",{className:"cart-item-count",children:[l.length," Ã¼rÃ¼n"]})]}),a.jsxs("div",{className:"cart-content",children:[a.jsxs("div",{className:"cart-items-section",children:[a.jsxs("div",{className:"cart-items-header",children:[a.jsx("h2",{children:"ÃœrÃ¼nler"}),a.jsx("button",{className:"clear-cart-btn",onClick:d,children:"Sepeti Temizle"})]}),a.jsx("div",{className:"cart-items",children:l.map((e,s)=>a.jsxs("div",{className:"cart-item",children:[a.jsxs(i,{to:"/product/"+e.id,className:"cart-item-image-wrapper",children:[a.jsx("div",{className:"cart-item-image",children:a.jsx("img",{src:e.image,alt:e.name})}),e.quantity>1&&a.jsxs("div",{className:"quantity-badge",children:[e.quantity,"x"]})]}),a.jsxs("div",{className:"cart-item-content",children:[a.jsxs("div",{className:"cart-item-main-info",children:[a.jsxs("div",{className:"cart-item-title-section",children:[a.jsx(i,{to:"/product/"+e.id,className:"cart-item-name",children:e.name}),e.category&&a.jsx("span",{className:"cart-item-category",children:e.category})]}),a.jsx("button",{className:"remove-item-btn",onClick:()=>T(e.id,e.itemKey,e.cartItemId),"aria-label":"ÃœrÃ¼nÃ¼ kaldÄ±r",children:a.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[a.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),a.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.customizations&&a.jsxs("div",{className:"cart-item-customizations",children:[a.jsxs("div",{className:"customization-item",children:[a.jsx("span",{className:"customization-label",children:"En"}),a.jsxs("span",{className:"customization-value",children:[e.customizations.en," cm"]})]}),a.jsxs("div",{className:"customization-item",children:[a.jsx("span",{className:"customization-label",children:"Boy"}),a.jsxs("span",{className:"customization-value",children:[e.customizations.boy," cm"]})]}),a.jsxs("div",{className:"customization-item",children:[a.jsx("span",{className:"customization-label",children:"Pile"}),a.jsx("span",{className:"customization-value",children:"pilesiz"===e.customizations.pileSikligi?"Pilesiz":e.customizations.pileSikligi})]})]}),a.jsxs("div",{className:"cart-item-actions",children:[a.jsxs("div",{className:"cart-item-price-section",children:[a.jsx("span",{className:"price-label",children:"Birim Fiyat"}),a.jsxs("span",{className:"unit-price",children:[(e.customizations?.calculatedPrice||e.price).toFixed(2)," â‚º"]})]}),a.jsxs("div",{className:"cart-quantity-controls",children:[a.jsx("span",{className:"quantity-label",children:"Adet"}),a.jsxs("div",{className:"cart-quantity",children:[a.jsx("button",{onClick:()=>B(e.id,e.quantity-1,e.itemKey,e.cartItemId),"aria-label":"Azalt",className:"quantity-btn",children:a.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})}),a.jsx("span",{className:"quantity-value",children:e.quantity}),a.jsx("button",{onClick:()=>B(e.id,e.quantity+1,e.itemKey,e.cartItemId),"aria-label":"ArtÄ±r",className:"quantity-btn",children:a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[a.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]})]}),a.jsxs("div",{className:"cart-item-total-price",children:[a.jsx("span",{className:"total-label",children:"Toplam"}),a.jsxs("span",{className:"total-price",children:[((e.customizations?.calculatedPrice||e.price)*e.quantity).toFixed(2)," â‚º"]})]})]})]})]},e.itemKey||`${e.id}_${s}`))})]}),a.jsxs("div",{className:"cart-summary",children:[a.jsx("h3",{children:"SipariÅŸ Ã–zeti"}),a.jsxs("div",{className:"coupon-section",children:[x?a.jsxs("div",{className:"coupon-applied",children:[a.jsxs("div",{className:"coupon-applied-header",children:[a.jsx("div",{className:"coupon-icon-small",children:a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})})}),a.jsxs("div",{className:"coupon-applied-info",children:[a.jsx("span",{className:"coupon-code-label",children:"Kupon:"}),a.jsx("span",{className:"coupon-code-value",children:x})]}),a.jsxs("span",{className:"coupon-discount",children:["-",p.toFixed(2)," â‚º"]})]}),a.jsx("button",{className:"remove-coupon-btn",onClick:async()=>{try{w(!0),I(""),q("");let e=null;v&&N||(e=localStorage.getItem("guestUserId"));const s=`${c}/cart/coupon${e?"?guestUserId="+e:""}`,a=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json",...N&&{Authorization:"Bearer "+N}}}),i=await a.json();a.ok&&(i.isSuccess||i.success)?(q("Kupon kaldÄ±rÄ±ldÄ±"),y(null),j(0),await h()):I(i.message||"Kupon kaldÄ±rÄ±lamadÄ±")}catch(e){I("Kupon kaldÄ±rÄ±lÄ±rken bir hata oluÅŸtu")}finally{w(!1)}},disabled:C,children:C?"KaldÄ±rÄ±lÄ±yor...":"KaldÄ±r"})]}):a.jsxs("div",{className:"coupon-input-group",children:[a.jsx("input",{type:"text",placeholder:"Kupon kodu",value:b,onChange:e=>{k(e.target.value.toUpperCase()),I(""),q("")},onKeyPress:e=>{"Enter"===e.key&&A()},className:"coupon-input",disabled:z||!v}),a.jsx("button",{className:"apply-coupon-btn",onClick:A,disabled:z||!v||!b.trim(),children:z?"...":"Uygula"})]}),S&&a.jsx("div",{className:"coupon-message coupon-error",children:S}),K&&a.jsx("div",{className:"coupon-message coupon-success",children:K}),!v&&!x&&a.jsx("div",{className:"coupon-hint",children:"Kupon iÃ§in giriÅŸ yapÄ±n"})]}),a.jsx("div",{className:"summary-divider"}),a.jsxs("div",{className:"summary-details",children:[a.jsxs("div",{className:"summary-row",children:[a.jsx("span",{children:"Ara Toplam"}),a.jsxs("span",{children:[u().toFixed(2)," â‚º"]})]}),p>0&&a.jsxs("div",{className:"summary-row discount-row",children:[a.jsxs("span",{children:["Ä°ndirim (",x,")"]}),a.jsxs("span",{className:"discount-amount",children:["-",p.toFixed(2)," â‚º"]})]}),a.jsxs("div",{className:"summary-row",children:[a.jsx("span",{children:"Kargo"}),a.jsx("span",{className:"free-shipping",children:"Ãœcretsiz"})]})]}),a.jsxs("div",{className:"summary-total",children:[a.jsx("span",{children:"Toplam"}),a.jsxs("span",{children:[m().toFixed(2)," â‚º"]})]}),a.jsx("button",{className:"checkout-btn",onClick:()=>g("/checkout"),children:"Ã–demeye GeÃ§"}),a.jsx(i,{to:"/",className:"continue-shopping",children:"AlÄ±ÅŸveriÅŸe Devam Et"})]})]})]})};export{l as default};
