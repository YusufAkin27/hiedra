import{u as e,r as s,j as a,L as t}from"./react-vendor-DfawjiNX.js";import{u as i,a as n}from"./context-BaHiGFT-.js";import"./vendor-invariant-GfE-dftQ.js";import"./vendor-shallowequal-DDPVF0Lr.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BfCtOoOM.js";const c="http://localhost:8080/api",r=()=>{const{cartItems:r,removeFromCart:l,updateQuantity:o,clearCart:d,getCartTotal:u,getCartSubtotal:m,refreshCart:p,discountAmount:h,couponCode:j,setDiscountAmount:x,setCouponCode:y}=i(),{accessToken:g,isAuthenticated:v}=n(),N=e(),[k,b]=s.useState(""),[f,z]=s.useState(!1),[C,S]=s.useState(!1),[I,K]=s.useState(""),[w,U]=s.useState("");s.useEffect(()=>{p()},[]);const T=async()=>{if(k.trim())if(v)try{z(!0),K(""),U("");let e=null;v&&g||(e=localStorage.getItem("guestUserId"));const s=`${c}/cart/apply-coupon${e?"?guestUserId="+e:""}`,a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...g&&{Authorization:"Bearer "+g}},body:JSON.stringify({couponCode:k.trim().toUpperCase()})}),t=await a.json();a.ok&&(t.isSuccess||t.success)?(U("Kupon başarıyla uygulandı!"),b(""),await p()):K(t.message||"Kupon uygulanamadı")}catch(e){K("Kupon uygulanırken bir hata oluştu")}finally{z(!1)}else K("Kupon uygulamak için lütfen giriş yapınız");else K("Lütfen kupon kodunu giriniz")},$=async(e,s=null,a=null)=>{try{if(a&&s&&s.startsWith("backend_")){let e=null;v&&g||(e=localStorage.getItem("guestUserId"));const s=`${c}/cart/items/${a}${e?"?guestUserId="+e:""}`;if((await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json",...g&&{Authorization:"Bearer "+g}}})).ok)return void(await p())}l(e,s)}catch(t){l(e,s)}},A=async(e,s,a=null,t=null)=>{if(s>0)try{if(t&&a&&a.startsWith("backend_")){let e=null;v&&g||(e=localStorage.getItem("guestUserId"));const a=`${c}/cart/items/${t}${e?"?guestUserId="+e:""}`;if((await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json",...g&&{Authorization:"Bearer "+g}},body:JSON.stringify({quantity:s})})).ok)return void(await p())}o(e,s,a)}catch(i){o(e,s,a)}else $(e,a,t)};return 0===r.length?a.jsx("div",{className:"cart-container",children:a.jsxs("div",{className:"empty-cart",children:[a.jsx("h2",{children:"Sepetiniz boş"}),a.jsx("p",{children:"Alışverişe başlamak için ürünlerimizi inceleyin"}),a.jsx(t,{to:"/",className:"shop-btn",children:"Alışverişe Başla"})]})}):a.jsxs("div",{className:"cart-container",children:[a.jsxs("div",{className:"cart-header",children:[a.jsx("h2",{children:"Sepetim"}),a.jsx("button",{className:"clear-cart-btn",onClick:d,children:"Sepeti Temizle"})]}),a.jsxs("div",{className:"cart-content",children:[a.jsx("div",{className:"cart-items",children:r.map((e,s)=>a.jsxs("div",{className:"cart-item",children:[a.jsx(t,{to:"/product/"+e.id,className:"cart-item-image",children:a.jsx("img",{src:e.image,alt:e.name})}),a.jsxs("div",{className:"cart-item-info",children:[a.jsx(t,{to:"/product/"+e.id,className:"cart-item-name",children:e.name}),a.jsx("span",{className:"cart-item-category",children:e.category}),e.customizations&&a.jsxs("div",{className:"cart-item-customizations",children:[a.jsxs("div",{className:"customization-item",children:[a.jsx("span",{children:"En:"}),a.jsxs("span",{children:[e.customizations.en," cm"]})]}),a.jsxs("div",{className:"customization-item",children:[a.jsx("span",{children:"Boy:"}),a.jsxs("span",{children:[e.customizations.boy," cm"]})]}),a.jsxs("div",{className:"customization-item",children:[a.jsx("span",{children:"Pile:"}),a.jsx("span",{children:"pilesiz"===e.customizations.pileSikligi?"Pilesiz":e.customizations.pileSikligi})]})]})]}),a.jsxs("div",{className:"cart-item-controls",children:[a.jsxs("div",{className:"cart-quantity",children:[a.jsx("button",{onClick:()=>A(e.id,e.quantity-1,e.itemKey,e.cartItemId),children:"-"}),a.jsx("span",{children:e.quantity}),a.jsx("button",{onClick:()=>A(e.id,e.quantity+1,e.itemKey,e.cartItemId),children:"+"})]}),a.jsxs("div",{className:"cart-item-price",children:[((e.customizations?.calculatedPrice||e.price)*e.quantity).toFixed(2)," ₺"]}),a.jsx("button",{className:"remove-item-btn",onClick:()=>$(e.id,e.itemKey,e.cartItemId),children:"✕"})]})]},e.itemKey||`${e.id}_${s}`))}),a.jsxs("div",{className:"cart-summary",children:[a.jsx("h3",{children:"Sipariş Özeti"}),a.jsxs("div",{className:"coupon-section",children:[j?a.jsxs("div",{className:"coupon-applied",children:[a.jsxs("div",{className:"coupon-info",children:[a.jsx("span",{className:"coupon-code-label",children:"Uygulanan Kupon:"}),a.jsx("span",{className:"coupon-code-value",children:j}),a.jsxs("span",{className:"coupon-discount",children:["-",h.toFixed(2)," ₺"]})]}),a.jsx("button",{className:"remove-coupon-btn",onClick:async()=>{try{S(!0),K(""),U("");let e=null;v&&g||(e=localStorage.getItem("guestUserId"));const s=`${c}/cart/coupon${e?"?guestUserId="+e:""}`,a=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json",...g&&{Authorization:"Bearer "+g}}}),t=await a.json();a.ok&&(t.isSuccess||t.success)?(U("Kupon kaldırıldı"),y(null),x(0),await p()):K(t.message||"Kupon kaldırılamadı")}catch(e){K("Kupon kaldırılırken bir hata oluştu")}finally{S(!1)}},disabled:C,children:C?"Kaldırılıyor...":"Kaldır"})]}):a.jsxs("div",{className:"coupon-input-group",children:[a.jsx("input",{type:"text",placeholder:"Kupon kodu giriniz",value:k,onChange:e=>{b(e.target.value.toUpperCase()),K(""),U("")},onKeyPress:e=>{"Enter"===e.key&&T()},className:"coupon-input",disabled:f||!v}),a.jsx("button",{className:"apply-coupon-btn",onClick:T,disabled:f||!v||!k.trim(),children:f?"Uygulanıyor...":"Uygula"})]}),I&&a.jsx("div",{className:"coupon-error",children:I}),w&&a.jsx("div",{className:"coupon-success",children:w}),!v&&a.jsx("div",{className:"coupon-hint",children:"Kupon uygulamak için lütfen giriş yapınız"})]}),a.jsxs("div",{className:"summary-row",children:[a.jsx("span",{children:"Ara Toplam:"}),a.jsxs("span",{children:[m().toFixed(2)," ₺"]})]}),h>0&&a.jsxs("div",{className:"summary-row discount-row",children:[a.jsxs("span",{children:["Kupon İndirimi (",j,"):"]}),a.jsxs("span",{className:"discount-amount",children:["-",h.toFixed(2)," ₺"]})]}),a.jsxs("div",{className:"summary-row",children:[a.jsx("span",{children:"Kargo:"}),a.jsx("span",{className:"free-shipping",children:"Ücretsiz"})]}),a.jsxs("div",{className:"summary-row total",children:[a.jsx("span",{children:"Toplam:"}),a.jsxs("span",{children:[u().toFixed(2)," ₺"]})]}),a.jsx("button",{className:"checkout-btn",onClick:()=>N("/checkout"),children:"Ödemeye Geç"}),a.jsx(t,{to:"/",className:"continue-shopping",children:"Alışverişe Devam Et"})]})]})]})};export{r as default};
