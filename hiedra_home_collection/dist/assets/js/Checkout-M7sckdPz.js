import{u as e,r as s,j as i}from"./react-vendor-2SZXphvN.js";import{u as a,a as r}from"./context-DM-lvtsQ.js";import{u as t}from"./index-DbqS-Y-U.js";import{S as n}from"./SEO-BxBC3DWO.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";const l="http://localhost:8080/api",d=()=>{const d=e(),c=a(),{user:o,accessToken:m,isAuthenticated:h}=r(),p=t(),u=c?.cartItems||[],x=c?.getCartTotal||(()=>0),g=c?.getCartSubtotal||(()=>0),j=c?.clearCart||(()=>{}),f=c?.couponCode||null,y=c?.discountAmount||0,N=c?.cartId||null,[v,b]=s.useState(1),[z,k]=s.useState(!1),[S,w]=s.useState([]),[C,D]=s.useState(null),[q,I]=s.useState(!1),[A,M]=s.useState(!1),[B,L]=s.useState({firstName:"",lastName:"",email:"",phone:""}),[P,T]=s.useState({address:"",city:"",district:"",addressDetail:""}),[F,Y]=s.useState({cardNumber:"",cardName:"",expiryMonth:"",expiryYear:"",cvv:""});s.useEffect(()=>{h&&m?K():L({firstName:"",lastName:"",email:"",phone:""})},[h,m]);const K=async()=>{try{const e=await fetch(l+"/user/profile",{headers:{Authorization:"Bearer "+m,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();if(s.isSuccess||s.success){const e=s.data||s;let i="",a="";if(e.fullName){const s=e.fullName.trim().split(/\s+/);i=s[0]||"",a=s.slice(1).join(" ")||""}L({firstName:i,lastName:a,email:e.email||o?.email||"",phone:e.phone||o?.phone||""})}}}catch(e){if(o){let e="",s="";if(o.fullName){const i=o.fullName.trim().split(/\s+/);e=i[0]||"",s=i.slice(1).join(" ")||""}L({firstName:e,lastName:s,email:o.email||"",phone:o.phone||""})}}};s.useEffect(()=>{h&&m&&(2===v||1===v)&&O()},[h,m,v]);const O=async()=>{try{M(!0);const e=await fetch(l+"/user/addresses",{headers:{Authorization:"Bearer "+m,"Content-Type":"application/json"}});if(e.ok){const s=await e.json();if(s.isSuccess||s.success){const e=s.data||[];w(e);const i=e.find(e=>e.isDefault)||e[0];i&&(D(i.id),I(!0),E(i),P.address||P.city||P.district||E(i))}}}catch(e){}finally{M(!1)}},E=e=>{e&&T({address:e.addressLine,city:e.city,district:e.district,addressDetail:e.addressDetail||""})},U=e=>{D(e);const s=S.find(s=>s.id===e);s&&E(s)},R=(e=>{const s=e.replace(/\s/g,"");return s?/^4/.test(s)?"visa":/^5[1-5]/.test(s)||/^2[2-7]/.test(s)?"mastercard":/^3[47]/.test(s)?"amex":/^6(?:011|5|4[4-9])/.test(s)?"discover":/^9792/.test(s)?"troy":null:null})(F.cardNumber);if(0===u.length)return i.jsx("div",{className:"checkout-container",children:i.jsxs("div",{className:"empty-checkout",children:[i.jsx("h2",{children:"Sepetiniz boş"}),i.jsx("p",{children:"Ödeme yapmak için sepetinizde ürün bulunmalıdır."}),i.jsx("button",{onClick:()=>d("/"),className:"shop-btn",children:"Alışverişe Başla"})]})});const V={"@context":"https://schema.org","@type":"CheckoutPage",name:"Ödeme - Hiedra Perde",description:"Hiedra Perde siparişinizi tamamlayın. Güvenli ödeme sistemi ile alışveriş yapın.",url:window.location.href};return i.jsxs("div",{className:"checkout-container",children:[i.jsx(n,{title:"Ödeme - Perde Satış Ödeme Sayfası",description:"Perde satış ödeme sayfası. Güvenli ödeme sistemi ile siparişinizi tamamlayın. Hiedra Perde ile güvenli alışveriş.",keywords:"perde ödeme, online perde ödeme, perde satış ödeme, güvenli ödeme, perde sipariş ödeme",url:"/checkout",structuredData:V,noindex:!0}),i.jsxs("header",{className:"checkout-header",children:[i.jsx("h1",{children:"Ödeme"}),i.jsx("div",{className:"checkout-steps",children:[1,2,3,4].map(e=>i.jsxs("div",{className:`step ${e>v?"":"active"} ${v===e?"current":""}`,children:[i.jsx("div",{className:"step-number",children:e}),i.jsxs("div",{className:"step-label",children:[1===e&&"İletişim",2===e&&"Adres",3===e&&"Ödeme",4===e&&"Özet"]})]},e))})]}),i.jsxs("div",{className:"checkout-content",children:[i.jsxs("div",{className:"checkout-form-section",children:[1===v&&i.jsxs("section",{className:"checkout-step",children:[i.jsx("h2",{children:"İletişim Bilgileri"}),h&&o&&i.jsx("div",{style:{padding:"1rem",marginBottom:"1.5rem",backgroundColor:"#e7f3ff",borderRadius:"4px",border:"1px solid #b3d9ff",fontSize:"0.9rem",color:"#004085"},children:i.jsxs("p",{style:{margin:0},children:[i.jsx("strong",{children:"Bilgi:"})," İletişim bilgileriniz profilinizden otomatik olarak doldurulmuştur. İsterseniz değiştirebilirsiniz."]})}),!h&&i.jsx("div",{style:{padding:"1rem",marginBottom:"1.5rem",backgroundColor:"#f8f9fa",borderRadius:"4px",border:"1px solid #dee2e6"},children:i.jsx("p",{style:{margin:0,color:"#495057"},children:"Lütfen iletişim bilgilerinizi giriniz. Tüm alanları doldurmanız gerekmektedir."})}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"firstName",children:["Ad ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{type:"text",id:"firstName",name:"firstName",value:B.firstName,onChange:e=>L({...B,firstName:e.target.value}),placeholder:"Adınız",autoComplete:"given-name",required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"lastName",children:["Soyad ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{type:"text",id:"lastName",name:"lastName",value:B.lastName,onChange:e=>L({...B,lastName:e.target.value}),placeholder:"Soyadınız",autoComplete:"family-name",required:!0})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"email",children:["E-posta ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{type:"email",id:"email",name:"email",value:B.email,onChange:e=>L({...B,email:e.target.value}),placeholder:"ornek@email.com",autoComplete:"email",required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"phone",children:["Telefon ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{type:"tel",id:"phone",name:"phone",value:B.phone,onChange:e=>{const s=e.target.value.replace(/\D/g,"");s.length>11||L({...B,phone:s})},placeholder:"05XX XXX XX XX",autoComplete:"tel",required:!0})]})]}),2===v&&i.jsxs("section",{className:"checkout-step",children:[i.jsx("h2",{children:"Adres Bilgileri"}),!h&&i.jsx("div",{style:{padding:"1rem",marginBottom:"1.5rem",backgroundColor:"#f8f9fa",borderRadius:"4px",border:"1px solid #dee2e6"},children:i.jsx("p",{style:{margin:0,color:"#495057"},children:"Lütfen teslimat adresinizi giriniz. Tüm alanları doldurmanız gerekmektedir."})}),h&&S.length>0&&i.jsx("div",{style:{padding:"1rem",marginBottom:"1.5rem",backgroundColor:"#e7f3ff",borderRadius:"4px",border:"1px solid #b3d9ff",fontSize:"0.9rem",color:"#004085"},children:i.jsxs("p",{style:{margin:0},children:[i.jsx("strong",{children:"Bilgi:"})," Varsayılan adresiniz otomatik olarak seçilmiştir. Kayıtlı adreslerinizden birini seçebilir veya yeni adres girebilirsiniz."]})}),h&&S.length>0&&i.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[i.jsxs("label",{children:[i.jsx("input",{type:"checkbox",checked:q,onChange:e=>{if(I(e.target.checked),e.target.checked&&C){const e=S.find(e=>e.id===C);e&&E(e)}else e.target.checked||T({address:"",city:"",district:"",addressDetail:""})},style:{marginRight:"0.5rem"}}),"Kayıtlı adreslerimden seç"]}),q&&i.jsx("div",{style:{marginTop:"1rem",padding:"1rem",border:"1px solid #ddd",borderRadius:"4px"},children:A?i.jsx("p",{children:"Adresler yükleniyor..."}):i.jsx("div",{children:S.map(e=>i.jsx("div",{style:{padding:"0.75rem",marginBottom:"0.5rem",border:C===e.id?"2px solid #007bff":"1px solid #ddd",borderRadius:"4px",cursor:"pointer",backgroundColor:C===e.id?"#f0f8ff":"#fff"},onClick:()=>U(e.id),children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[i.jsxs("div",{style:{flex:1},children:[i.jsxs("div",{style:{fontWeight:"bold",marginBottom:"0.25rem"},children:[e.fullName,e.isDefault&&i.jsx("span",{style:{marginLeft:"0.5rem",fontSize:"0.85rem",color:"#28a745"},children:"(Varsayılan)"})]}),i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666"},children:[e.addressLine,e.addressDetail&&", "+e.addressDetail]}),i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666"},children:[e.district,", ",e.city]}),i.jsx("div",{style:{fontSize:"0.9rem",color:"#666"},children:e.phone})]}),i.jsx("input",{type:"radio",name:"selectedAddress",checked:C===e.id,onChange:()=>U(e.id),style:{marginLeft:"1rem"}})]})},e.id))})})]}),(!h||!q)&&i.jsxs(i.Fragment,{children:[h&&!q&&i.jsx("div",{style:{padding:"0.75rem",marginBottom:"1rem",backgroundColor:"#fff3cd",borderRadius:"4px",border:"1px solid #ffc107",fontSize:"0.9rem",color:"#856404"},children:"Yeni adres bilgilerinizi giriniz."}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"address",children:["Adres ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{type:"text",id:"address",name:"address",value:P.address,onChange:e=>T({...P,address:e.target.value}),placeholder:"Mahalle, Sokak, Cadde",autoComplete:"street-address",required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"addressDetail",children:"Adres Detayı (Opsiyonel)"}),i.jsx("textarea",{id:"addressDetail",value:P.addressDetail,onChange:e=>T({...P,addressDetail:e.target.value}),placeholder:"Daire no, kat, bina adı vb.",rows:"3"})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"city",children:["Şehir ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{type:"text",id:"city",name:"city",value:P.city,onChange:e=>T({...P,city:e.target.value}),required:!0,placeholder:"Şehir adı"})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"district",children:["İlçe ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{type:"text",id:"district",name:"district",value:P.district,onChange:e=>T({...P,district:e.target.value}),required:!0,placeholder:"İlçe adı"})]})]})]})]}),3===v&&i.jsxs("section",{className:"checkout-step",children:[i.jsx("h2",{children:"Ödeme Bilgileri"}),i.jsx("p",{className:"step-description",children:"Güvenli ödeme için kart bilgilerinizi giriniz"}),i.jsx("div",{className:"supported-cards",children:i.jsxs("div",{className:"card-icons",children:[i.jsx("span",{className:"card-icon "+("visa"===R?"active":""),title:"Visa",children:i.jsx("img",{src:"/images/visa.png",alt:"Visa",className:"card-logo-img"})}),i.jsx("span",{className:"card-icon "+("mastercard"===R?"active":""),title:"Mastercard",children:i.jsx("img",{src:"/images/master.png",alt:"Mastercard",className:"card-logo-img"})}),i.jsx("span",{className:"card-icon "+("troy"===R?"active":""),title:"Troy",children:i.jsx("img",{src:"/images/troy.png",alt:"Troy",className:"card-logo-img"})})]})}),i.jsxs("form",{autoComplete:"on",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"cardNumber",children:["Kart Numarası ",i.jsx("span",{className:"required",children:"*"})]}),i.jsxs("div",{className:"card-input-wrapper",children:[i.jsx("input",{type:"tel",id:"cardNumber",name:"cardNumber",value:F.cardNumber,onChange:e=>{const s=(e=>{const s=e.replace(/\s/g,"");return(s.match(/.{1,4}/g)?.join(" ")||s).slice(0,19)})(e.target.value);Y({...F,cardNumber:s})},placeholder:"1234 5678 9012 3456",maxLength:"19",autoComplete:"cc-number",inputMode:"numeric",pattern:"[0-9\\s]{13,19}",required:!0}),R&&i.jsxs("div",{className:"detected-card-icon",children:["visa"===R&&i.jsx("img",{src:"/images/visa.png",alt:"Visa",className:"detected-card-logo"}),"mastercard"===R&&i.jsx("img",{src:"/images/master.png",alt:"Mastercard",className:"detected-card-logo"}),"troy"===R&&i.jsx("img",{src:"/images/troy.png",alt:"Troy",className:"detected-card-logo"})]})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"cardName",children:["Kart Üzerindeki İsim ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{type:"text",id:"cardName",name:"cardName",value:F.cardName,onChange:e=>Y({...F,cardName:e.target.value.toUpperCase()}),placeholder:"AD SOYAD",autoComplete:"cc-name",required:!0})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"expiryMonth",children:["Son Kullanma Tarihi ",i.jsx("span",{className:"required",children:"*"})]}),i.jsxs("div",{className:"expiry-inputs",children:[i.jsxs("select",{id:"expiryMonth",name:"expiryMonth",value:F.expiryMonth,onChange:e=>Y({...F,expiryMonth:e.target.value}),autoComplete:"cc-exp-month",required:!0,children:[i.jsx("option",{value:"",children:"Ay"}),Array.from({length:12},(e,s)=>s+1).map(e=>i.jsx("option",{value:(e+"").padStart(2,"0"),children:(e+"").padStart(2,"0")},e))]}),i.jsxs("select",{id:"expiryYear",name:"expiryYear",value:F.expiryYear,onChange:e=>Y({...F,expiryYear:e.target.value}),autoComplete:"cc-exp-year",required:!0,children:[i.jsx("option",{value:"",children:"Yıl"}),Array.from({length:10},(e,s)=>(new Date).getFullYear()+s).map(e=>i.jsx("option",{value:(e+"").slice(-2),children:e},e))]})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"cvv",children:["CVV ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{type:"tel",id:"cvv",name:"cvv",value:F.cvv,onChange:e=>{const s=e.target.value.replace(/\D/g,"");s.length>3||Y({...F,cvv:s})},placeholder:"123",maxLength:"3",autoComplete:"cc-csc",inputMode:"numeric",pattern:"[0-9]{3}",required:!0})]})]})]})]}),4===v&&i.jsxs("section",{className:"checkout-step",children:[i.jsx("h2",{children:"Sipariş Özeti"}),i.jsx("p",{className:"step-description",children:"Lütfen bilgilerinizi kontrol ediniz"}),i.jsxs("div",{className:"summary-section",children:[i.jsxs("div",{className:"summary-info-card",children:[i.jsxs("div",{className:"card-header-with-edit",children:[i.jsx("h3",{children:"İletişim Bilgileri"}),i.jsx("button",{type:"button",className:"edit-info-btn-card",onClick:()=>{b(1)},"aria-label":"İletişim bilgilerini düzenle",children:i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),i.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),i.jsxs("div",{className:"info-details",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Ad Soyad:"})," ",B.firstName," ",B.lastName]}),i.jsxs("p",{children:[i.jsx("strong",{children:"E-posta:"})," ",B.email]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Telefon:"})," ",B.phone]})]})]}),i.jsxs("div",{className:"summary-info-card",children:[i.jsxs("div",{className:"card-header-with-edit",children:[i.jsx("h3",{children:"Adres Bilgileri"}),i.jsx("button",{type:"button",className:"edit-info-btn-card",onClick:()=>{b(2)},"aria-label":"Adres bilgilerini düzenle",children:i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),i.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),i.jsxs("div",{className:"info-details",children:[i.jsx("p",{children:P.address}),i.jsxs("p",{children:[P.district,", ",P.city]}),P.addressDetail&&i.jsxs("p",{children:[i.jsx("strong",{children:"Adres Detayı:"})," ",P.addressDetail]})]})]}),i.jsxs("div",{className:"summary-info-card",children:[i.jsxs("div",{className:"card-header-with-edit",children:[i.jsx("h3",{children:"Ödeme Bilgileri"}),i.jsx("button",{type:"button",className:"edit-info-btn-card",onClick:()=>{b(3)},"aria-label":"Ödeme bilgilerini düzenle",children:i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),i.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),i.jsxs("div",{className:"info-details",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Kart Numarası:"})," •••• •••• •••• ",4>F.cardNumber.length?"":F.cardNumber.slice(-4)]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Kart Sahibi:"})," ",F.cardName]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Son Kullanma:"})," ",F.expiryMonth,"/",F.expiryYear]})]})]}),i.jsxs("div",{className:"summary-info-card",children:[i.jsx("h3",{children:"Sipariş Detayları"}),i.jsx("div",{className:"order-items-summary",children:u.map(e=>i.jsxs("div",{className:"order-item",children:[i.jsxs("div",{className:"order-item-info",children:[i.jsx("span",{className:"order-item-name",children:e.name}),e.customizations&&i.jsxs("div",{className:"order-item-details",children:[i.jsxs("span",{children:["En: ",e.customizations.en," cm"]}),i.jsxs("span",{children:["Boy: ",e.customizations.boy," cm"]}),i.jsxs("span",{children:["Pile: ","pilesiz"===e.customizations.pileSikligi?"Pilesiz":e.customizations.pileSikligi]})]}),i.jsxs("span",{className:"order-item-quantity",children:["Adet: ",e.quantity]})]}),i.jsxs("div",{className:"order-item-price",children:[((e.customizations?.calculatedPrice||e.price)*e.quantity).toFixed(2)," ₺"]})]},e.itemKey||e.id))}),i.jsxs("div",{className:"order-total-summary",children:[i.jsxs("div",{className:"total-row",children:[i.jsx("span",{children:"Ara Toplam:"}),i.jsxs("span",{children:[g().toFixed(2)," ₺"]})]}),y>0&&f&&i.jsxs("div",{className:"total-row discount-row",children:[i.jsxs("span",{children:["Kupon İndirimi (",f,"):"]}),i.jsxs("span",{className:"discount-amount",children:["-",y.toFixed(2)," ₺"]})]}),i.jsxs("div",{className:"total-row",children:[i.jsx("span",{children:"Kargo:"}),i.jsx("span",{className:"free-shipping",children:"Ücretsiz"})]}),i.jsxs("div",{className:"total-row final",children:[i.jsx("span",{children:"Toplam:"}),i.jsxs("span",{children:[x().toFixed(2)," ₺"]})]})]})]})]})]}),i.jsxs("div",{className:"checkout-actions",children:[v>1&&i.jsx("button",{type:"button",onClick:()=>{v>1&&b(v-1)},className:"btn-back",children:"← Geri"}),4>v?i.jsx("button",{type:"button",onClick:()=>{1===v?(B.firstName.trim()?B.lastName.trim()?B.email.trim()&&B.email.includes("@")?B.phone.trim()&&B.phone.length>=10||(p.warning("Lütfen geçerli bir telefon numarası giriniz."),0):(p.warning("Lütfen geçerli bir e-posta adresi giriniz."),0):(p.warning("Lütfen soyadınızı giriniz."),0):(p.warning("Lütfen adınızı giriniz."),0))&&b(2):2===v?(P.address.trim()?P.city.trim()?P.district.trim()||(p.warning("Lütfen ilçe bilgisini giriniz."),0):(p.warning("Lütfen şehir bilgisini giriniz."),0):(p.warning("Lütfen adres bilgilerinizi giriniz."),0))&&b(3):3===v&&(()=>{const e=F.cardNumber.replace(/\s/g,"");return e&&16===e.length&&/^\d+$/.test(e)?F.cardName.trim()?F.expiryMonth&&F.expiryYear?!(!F.cvv||3!==F.cvv.length||!/^\d+$/.test(F.cvv))||(p.warning("Lütfen geçerli bir CVV giriniz (3 haneli)."),!1):(p.warning("Lütfen kart son kullanma tarihini seçiniz."),!1):(p.warning("Lütfen kart üzerindeki ismi giriniz."),!1):(p.warning("Lütfen geçerli bir kart numarası giriniz (16 haneli)."),!1)})()&&b(4)},className:"btn-next",children:3===v?"Özet'e Git →":"İlerle →"}):4===v?i.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),(async e=>{if(e&&(e.preventDefault(),e.stopPropagation()),!z){k(!0);try{const e=await(async()=>{try{const s=F.cardNumber.replace(/\s/g,""),i=`${F.expiryMonth}/${F.expiryYear}`,a=u.map(e=>{const s=(e.customizations?.calculatedPrice||e.price)*e.quantity,i=e.customizations?.en||100,a=e.customizations?.boy||200;return{productId:e.id,productName:e.name,width:i,height:a,pleatType:"pilesiz"===e.customizations?.pileSikligi?"1x1":e.customizations?.pileSikligi||"1x1",quantity:e.quantity,price:s}});let r=null;h&&m||(r=localStorage.getItem("guestUserId"));const t={amount:0,cardNumber:s,cardExpiry:i,cardCvc:F.cvv,firstName:B.firstName,lastName:B.lastName,email:B.email,phone:B.phone.replace(/\D/g,""),address:P.address,city:P.city,district:P.district,addressDetail:P.addressDetail||null,orderDetails:a,frontendCallbackUrl:window.location.origin+"/payment/3d-callback",addressId:h&&q&&C?C:null,userId:h&&o?.id?o.id:null,cartId:N||null,guestUserId:r,couponCode:f||null},n=await fetch(l+"/payment/card",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),d=(n.headers.get("content-type"),await n.text());let c;try{if(!d||""===d.trim())return{success:!1,message:"Sunucudan yanıt alınamadı."};c=JSON.parse(d)}catch(e){return d.trim().startsWith("<!DOCTYPE")||d.trim().startsWith("<html")?(sessionStorage.setItem("checkoutData",JSON.stringify({contactInfo:B,addressInfo:P,cardInfo:F,items:u,totalPrice:x()})),sessionStorage.setItem("frontendUrl",window.location.origin),document.open(),document.write(d),document.close(),{success:!1,message:"3D Secure yönlendirmesi yapılıyor...",redirecting:!0}):{success:!1,message:"Sunucu yanıtı işlenemedi: "+e.message}}if(n.ok){const e=!0===c.isSuccess||!0===c.success;if(e&&c.data&&"string"==typeof c.data&&(c.data.trim().startsWith("<!DOCTYPE")||c.data.trim().startsWith("<html")||c.data.includes("<form"))){sessionStorage.setItem("checkoutData",JSON.stringify({contactInfo:B,addressInfo:P,cardInfo:F,items:u,totalPrice:x()})),sessionStorage.setItem("frontendUrl",window.location.origin);const e=c.data;return document.open(),document.write(e),document.close(),{success:!1,message:"3D Secure yönlendirmesi yapılıyor...",redirecting:!0}}return!0===c.requires3D&&c.redirectUrl?(sessionStorage.setItem("checkoutData",JSON.stringify({contactInfo:B,addressInfo:P,cardInfo:F,items:u,totalPrice:x()})),sessionStorage.setItem("frontendUrl",window.location.origin),window.location.href=c.redirectUrl,{success:!1,message:"3D Secure yönlendirmesi yapılıyor...",redirecting:!0}):{success:e,message:c.message||(e?"Ödeme başarıyla tamamlandı":"Ödeme işlemi başarısız oldu")}}return{success:!1,message:c.message||`Hata: ${n.status} ${n.statusText}`}}catch(s){return{success:!1,message:s.message||"Ödeme işlemi sırasında bir hata oluştu."}}})();if(e.redirecting)return;if(e.success){const e={orderNumber:"ORD-"+Math.random().toString(36).substring(2,10).toUpperCase(),contactInfo:B,addressInfo:P,cardInfo:F,items:u,totalPrice:x()};j(),sessionStorage.removeItem("checkoutData"),d("/siparis-onayi",{state:{orderData:e}})}else k(!1),d("/odeme-basarisiz",{state:{errorMessage:e.message}})}catch(s){k(!1),d("/odeme-basarisiz")}}})(e)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},className:"btn-complete",disabled:z,children:z?"Ödeme İşleniyor...":"Ödeme Yap"}):null]})]}),i.jsxs("aside",{className:"checkout-summary",children:[i.jsx("h2",{children:"Sipariş Özeti"}),v>=1&&B.firstName&&i.jsxs("div",{className:"summary-info-section",children:[i.jsx("h3",{children:"İletişim"}),i.jsxs("div",{className:"summary-info-content",children:[i.jsxs("p",{children:[B.firstName," ",B.lastName]}),i.jsx("p",{children:B.email}),B.phone&&i.jsx("p",{children:B.phone})]})]}),v>=2&&P.address&&i.jsxs("div",{className:"summary-info-section",children:[i.jsx("h3",{children:"Adres"}),i.jsxs("div",{className:"summary-info-content",children:[i.jsx("p",{children:P.address}),i.jsxs("p",{children:[P.district,", ",P.city]})]})]}),v>=3&&F.cardNumber&&i.jsxs("div",{className:"summary-info-section",children:[i.jsx("h3",{children:"Ödeme"}),i.jsxs("div",{className:"summary-info-content",children:[i.jsxs("p",{children:["•••• •••• •••• ",4>F.cardNumber.length?"":F.cardNumber.slice(-4)]}),i.jsx("p",{children:F.cardName}),i.jsxs("p",{children:[F.expiryMonth,"/",F.expiryYear]})]})]}),i.jsx("div",{className:"summary-items",children:u.map(e=>i.jsxs("div",{className:"summary-item",children:[i.jsxs("div",{className:"summary-item-info",children:[i.jsx("span",{className:"item-name",children:e.name}),e.customizations&&i.jsxs("div",{className:"item-details",children:[i.jsxs("span",{children:["En: ",e.customizations.en," cm"]}),i.jsxs("span",{children:["Boy: ",e.customizations.boy," cm"]}),i.jsxs("span",{children:["Pile: ","pilesiz"===e.customizations.pileSikligi?"Pilesiz":e.customizations.pileSikligi]})]})]}),i.jsxs("div",{className:"summary-item-price",children:[((e.customizations?.calculatedPrice||e.price)*e.quantity).toFixed(2)," ₺"]})]},e.itemKey||e.id))}),i.jsxs("div",{className:"summary-total",children:[i.jsxs("div",{className:"total-row",children:[i.jsx("span",{children:"Ara Toplam:"}),i.jsxs("span",{children:[g().toFixed(2)," ₺"]})]}),y>0&&f&&i.jsxs("div",{className:"total-row discount-row",children:[i.jsxs("span",{children:["Kupon İndirimi (",f,"):"]}),i.jsxs("span",{className:"discount-amount",children:["-",y.toFixed(2)," ₺"]})]}),i.jsxs("div",{className:"total-row",children:[i.jsx("span",{children:"Kargo:"}),i.jsx("span",{className:"free-shipping",children:"Ücretsiz"})]}),i.jsxs("div",{className:"total-row final",children:[i.jsx("span",{children:"Toplam:"}),i.jsxs("span",{children:[x().toFixed(2)," ₺"]})]})]})]})]})]})};export{d as default};
