import{u as e,r,j as t,L as i}from"./react-vendor-2SZXphvN.js";import{a as s}from"./context-DM-lvtsQ.js";import{S as o}from"./SEO-BxBC3DWO.js";import{L as a}from"./LazyImage-CfhoafY7.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";import"./index-DbqS-Y-U.js";const n="http://localhost:8080/api",l=()=>{const{user:l,isAuthenticated:d,accessToken:c}=s(),m=e(),[u,p]=r.useState([]),[h,g]=r.useState(!0),[x,b]=r.useState(""),[f,y]=r.useState(""),[j,N]=r.useState({}),[k,v]=r.useState({}),[E,S]=r.useState(null),[I,C]=r.useState(0),[w,D]=r.useState(""),[A,z]=r.useState([]),[T,R]=r.useState([]),[F,L]=r.useState(!1),[B,P]=r.useState({});r.useEffect(()=>{d?W():m("/giris")},[d,l,c]),r.useEffect(()=>{u.length>0&&l?.email&&u.forEach(e=>{!e.trackingNumber||j[e.orderNumber]||k[e.orderNumber]||Y(e)})},[u,l?.email]);const W=async()=>{if(!l?.email)return b("KullanÄ±cÄ± bilgisi bulunamadÄ±"),void g(!1);try{g(!0),b("");const e=await fetch(n+"/orders/my-orders",{method:"GET",headers:{"Content-Type":"application/json",...c&&{Authorization:"Bearer "+c}}});if(!e.ok){if(401===e.status)throw Error("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n.");if(404===e.status)return void p([]);{const r=await e.json().catch(()=>({}));throw Error(r.message||`SipariÅŸler yÃ¼klenemedi (${e.status})`)}}const r=await e.json();if(r.isSuccess||r.success){const e=r.data||[];p(e)}else p([]),b(r.message||"SipariÅŸler yÃ¼klenemedi")}catch(e){b(e.message||"SipariÅŸler yÃ¼klenirken bir hata oluÅŸtu")}finally{g(!1)}},U=e=>{if(!e)return"status-unknown";const r=e.toUpperCase();return"DELIVERED"===r?"status-delivered":"SHIPPED"===r?"status-shipped":"PROCESSING"===r||"PAID"===r?"status-processing":"CANCELLED"===r||"REFUNDED"===r?"status-cancelled":"REFUND_REQUESTED"===r?"status-refund":"status-pending"},Y=async e=>{if(!e.trackingNumber||!l?.email)return;const r=e.orderNumber;if(!k[r]&&!j[r])try{v(e=>({...e,[r]:!0}));const t=new URL(n+"/shipping/track-by-order");t.searchParams.append("orderNumber",e.orderNumber),t.searchParams.append("email",l.email);const i=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json",...c&&{Authorization:"Bearer "+c}}}),s=await i.json();(s.isSuccess||s.success)&&N(e=>({...e,[r]:s.data}))}catch(t){}finally{v(e=>({...e,[r]:!1}))}},G=e=>e?{IN_TRANSIT:"Kargoda",DELIVERED:"Teslim Edildi",EXCEPTION:"Sorun Var",PENDING:"Beklemede",PICKED_UP:"Kargo AlÄ±ndÄ±",OUT_FOR_DELIVERY:"Teslimat Ä°Ã§in Yola Ã‡Ä±ktÄ±"}[e.toUpperCase()]||e:"Bilinmiyor",H=()=>{S(null),C(0),D(""),z([]),R([])};return r.useEffect(()=>{(async()=>{if(!u.length||!c)return;const e={};for(const t of u)if("DELIVERED"===t.status&&t.orderItems)for(const i of t.orderItems)if(i.productId&&!e[i.productId])try{const r=await fetch(`${n}/reviews/product/${i.productId}/user`,{headers:{Authorization:"Bearer "+c}});if(r.ok){const t=await r.json();t.isSuccess&&t.data&&(e[i.productId]=t.data.id)}}catch(r){}P(e)})()},[u,c]),d?t.jsxs("div",{className:"my-orders-container",children:[t.jsx(o,{title:"SipariÅŸlerim - Hiedra Perde",description:"SipariÅŸlerinizi gÃ¶rÃ¼ntÃ¼leyin ve takip edin",url:"/siparislerim"}),t.jsxs("header",{className:"my-orders-header",children:[t.jsx("h1",{children:"SipariÅŸlerim"}),t.jsx("p",{children:"TÃ¼m sipariÅŸlerinizi buradan gÃ¶rÃ¼ntÃ¼leyebilir ve takip edebilirsiniz"})]}),x&&!h&&t.jsx("div",{className:"error-message",style:{margin:"1rem",padding:"1rem",backgroundColor:"#fee",color:"#c33",borderRadius:"4px"},children:x}),f&&t.jsx("div",{className:"success-message",style:{margin:"1rem",padding:"1rem",backgroundColor:"#efe",color:"#3c3",borderRadius:"4px"},children:f}),h?t.jsxs("div",{className:"loading-state",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{children:"SipariÅŸler yÃ¼kleniyor..."})]}):x&&0===u.length?t.jsxs("div",{className:"error-state",children:[t.jsx("p",{children:x}),t.jsx("button",{onClick:W,className:"retry-btn",children:"Tekrar Dene"})]}):0===u.length?t.jsxs("div",{className:"empty-state",children:[t.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M9 2L7 6m6-4l2 4M3 8h18l-1 8H4L3 8z"}),t.jsx("circle",{cx:"7",cy:"20",r:"2"}),t.jsx("circle",{cx:"17",cy:"20",r:"2"})]}),t.jsx("h2",{children:"HenÃ¼z sipariÅŸiniz yok"}),t.jsx("p",{children:"Ä°lk sipariÅŸinizi vermek iÃ§in Ã¼rÃ¼nlerimizi inceleyin"}),t.jsx(i,{to:"/",className:"shop-btn",children:"AlÄ±ÅŸveriÅŸe BaÅŸla"})]}):t.jsx("div",{className:"orders-list",children:u.map(e=>{return t.jsxs("div",{className:"order-card",children:[t.jsxs("div",{className:"order-card-header",children:[t.jsxs("div",{className:"order-info",children:[t.jsxs("h3",{children:["SipariÅŸ No: ",e.orderNumber]}),t.jsx("span",{className:"status-badge "+U(e.status),children:(r=e.status,r?{PENDING:"Beklemede",PAID:"Ã–dendi",PROCESSING:"HazÄ±rlanÄ±yor",SHIPPED:"Kargoya Verildi",DELIVERED:"Teslim Edildi",CANCELLED:"Ä°ptal Edildi",REFUNDED:"Ä°ade Edildi",REFUND_REQUESTED:"Ä°ade Talebi"}[r.toUpperCase()]||r:"Bilinmiyor")})]}),t.jsxs("div",{className:"order-date",children:[t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("polyline",{points:"12 6 12 12 16 14"})]}),e.createdAt?new Date(e.createdAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Tarih bilgisi yok"]})]}),t.jsx("div",{className:"order-items-preview",children:e.orderItems&&e.orderItems.length>0?t.jsx(t.Fragment,{children:e.orderItems.map((r,i)=>{let s=r.productImageUrl||"/images/perde1kapak.jpg";s&&""!==s&&"null"!==s&&"undefined"!==s||(s="/images/perde1kapak.jpg"),s.startsWith("http")||s.startsWith("/")||(s="/"+s);const o="DELIVERED"===e.status&&r.productId,n=B[r.productId];return t.jsxs("div",{className:"order-item-preview",children:[t.jsx("div",{className:"order-item-image-wrapper",children:t.jsx(a,{src:s,alt:r.productName||"ÃœrÃ¼n",className:"order-item-image"})}),t.jsxs("div",{className:"order-item-info",children:[t.jsx("span",{className:"item-name",children:r.productName||"ÃœrÃ¼n"}),r.quantity>1&&t.jsxs("span",{className:"item-quantity",children:["Adet: ",r.quantity]}),o&&t.jsx("button",{onClick:()=>((e,r,t)=>{S({productId:e,productName:r,productImage:t}),C(0),D(""),z([]),R([])})(r.productId,r.productName,s),className:"review-btn",style:{marginTop:"0.5rem",padding:"0.5rem 1rem",background:n?"#94a3b8":"#667eea",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",transition:"all 0.2s"},disabled:n,children:n?"âœ“ Yorum YapÄ±ldÄ±":"â­ Yorum Yap"})]})]},r.id||i)})}):t.jsx("p",{className:"no-items-text",children:"SipariÅŸ detayÄ± bulunamadÄ±"})}),e.trackingNumber&&t.jsxs("div",{className:"order-tracking-section",style:{padding:"1rem",marginTop:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e0e0e0"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Kargo Takip:"})," ",e.trackingNumber,e.carrier&&t.jsxs("span",{style:{marginLeft:"0.5rem",color:"#64748b"},children:["(",e.carrier,")"]})]}),t.jsx("button",{onClick:()=>Y(e),disabled:k[e.orderNumber],style:{padding:"0.25rem 0.75rem",background:"#667eea",color:"white",border:"none",borderRadius:"4px",cursor:k[e.orderNumber]?"not-allowed":"pointer",fontSize:"0.85rem",opacity:k[e.orderNumber]?.6:1},children:k[e.orderNumber]?"YÃ¼kleniyor...":"GÃ¼ncelle"})]}),j[e.orderNumber]?t.jsxs("div",{style:{marginTop:"0.75rem"},children:[t.jsx("div",{style:{display:"inline-block",padding:"0.25rem 0.75rem",borderRadius:"4px",fontSize:"0.9rem",fontWeight:"600",backgroundColor:"DELIVERED"===j[e.orderNumber].status?"#d4edda":"IN_TRANSIT"===j[e.orderNumber].status?"#d1ecf1":"EXCEPTION"===j[e.orderNumber].status?"#f8d7da":"#fff3cd",color:"DELIVERED"===j[e.orderNumber].status?"#155724":"IN_TRANSIT"===j[e.orderNumber].status?"#0c5460":"EXCEPTION"===j[e.orderNumber].status?"#721c24":"#856404"},children:G(j[e.orderNumber].status)}),j[e.orderNumber].statusDescription&&t.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.9rem",color:"#64748b"},children:j[e.orderNumber].statusDescription}),j[e.orderNumber].events&&j[e.orderNumber].events.length>0&&t.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.85rem",color:"#64748b"},children:[t.jsx("strong",{children:"Son Hareket:"})," ",j[e.orderNumber].events[0].description||"Bilgi yok",j[e.orderNumber].events[0].location&&t.jsxs("span",{style:{marginLeft:"0.5rem"},children:["ğŸ“ ",j[e.orderNumber].events[0].location]})]}),t.jsx(i,{to:`/kargo-takip?trackingNumber=${e.trackingNumber}&orderNumber=${e.orderNumber}`,style:{display:"inline-block",marginTop:"0.75rem",color:"#667eea",textDecoration:"none",fontSize:"0.9rem",fontWeight:"600"},children:"â†’ DetaylÄ± Takip Bilgisi"})]}):t.jsx(i,{to:`/kargo-takip?trackingNumber=${e.trackingNumber}&orderNumber=${e.orderNumber}`,style:{display:"inline-block",marginTop:"0.5rem",color:"#667eea",textDecoration:"none",fontSize:"0.9rem",fontWeight:"600"},children:"â†’ Kargo Durumunu GÃ¶rÃ¼ntÃ¼le"})]}),t.jsxs("div",{className:"order-card-footer",children:[t.jsxs("div",{className:"order-total",children:[t.jsx("span",{children:"Toplam:"}),t.jsxs("span",{className:"total-amount",children:[(()=>{if(void 0!==e.totalAmount&&null!==e.totalAmount){const r="string"==typeof e.totalAmount?parseFloat(e.totalAmount):parseFloat(e.totalAmount.toString());if(!isNaN(r)&&r>0)return r.toFixed(2)}if(e.orderItems&&e.orderItems.length>0){let r=0;if(e.orderItems.forEach(e=>{const t=e.price?"string"==typeof e.price?parseFloat(e.price):parseFloat(e.price.toString()):0,i=e.quantity||1;r+=t*i}),r>0){const t=e.shippingCost&&null!==e.shippingCost?"string"==typeof e.shippingCost?parseFloat(e.shippingCost):parseFloat(e.shippingCost.toString()):0,i=e.discountAmount&&null!==e.discountAmount?"string"==typeof e.discountAmount?parseFloat(e.discountAmount):parseFloat(e.discountAmount.toString()):0,s=e.taxAmount&&null!==e.taxAmount?"string"==typeof e.taxAmount?parseFloat(e.taxAmount):parseFloat(e.taxAmount.toString()):0,o=r+t-i+s;return o>0?o.toFixed(2):r.toFixed(2)}}if(void 0!==e.subtotal&&null!==e.subtotal){const r="string"==typeof e.subtotal?parseFloat(e.subtotal):parseFloat(e.subtotal.toString());if(!isNaN(r)&&r>0){const t=r+(e.shippingCost&&null!==e.shippingCost?"string"==typeof e.shippingCost?parseFloat(e.shippingCost):parseFloat(e.shippingCost.toString()):0)-(e.discountAmount&&null!==e.discountAmount?"string"==typeof e.discountAmount?parseFloat(e.discountAmount):parseFloat(e.discountAmount.toString()):0)+(e.taxAmount&&null!==e.taxAmount?"string"==typeof e.taxAmount?parseFloat(e.taxAmount):parseFloat(e.taxAmount.toString()):0);return t>0?t.toFixed(2):r.toFixed(2)}}return"0.00"})()," â‚º"]})]}),t.jsx("div",{className:"order-actions",children:t.jsx(i,{to:"/siparis/"+e.orderNumber,className:"view-order-btn",children:"DetaylarÄ± GÃ¶r"})})]})]},e.id||e.orderNumber);var r})}),E&&t.jsx("div",{className:"review-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"1rem"},onClick:H,children:t.jsxs("div",{className:"review-modal",style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",maxWidth:"600px",width:"100%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)"},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[t.jsx("h2",{style:{margin:0,fontSize:"1.5rem",fontWeight:"700"},children:"ÃœrÃ¼n Yorumu"}),t.jsx("button",{onClick:H,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"#64748b",padding:"0.25rem 0.5rem"},children:"Ã—"})]}),t.jsx("div",{style:{marginBottom:"1.5rem"},children:t.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[t.jsx("img",{src:E.productImage,alt:E.productName,style:{width:"80px",height:"80px",objectFit:"cover",borderRadius:"8px"}}),t.jsx("div",{children:t.jsx("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:"600"},children:E.productName})})]})}),t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"600"},children:["PuanÄ±nÄ±z ",t.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),t.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:[1,2,3,4,5].map(e=>t.jsx("button",{onClick:()=>C(e),style:{background:"none",border:"none",cursor:"pointer",fontSize:"2rem",padding:"0",lineHeight:"1"},children:e>I?"â˜†":"â­"},e))})]}),t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"600"},children:"Yorumunuz"}),t.jsx("textarea",{value:w,onChange:e=>D(e.target.value),placeholder:"ÃœrÃ¼n hakkÄ±ndaki dÃ¼ÅŸÃ¼ncelerinizi paylaÅŸÄ±n...",style:{width:"100%",minHeight:"120px",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",fontFamily:"inherit",resize:"vertical"},maxLength:2e3}),t.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b",marginTop:"0.25rem"},children:[w.length,"/2000 karakter"]})]}),t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"600"},children:"FotoÄŸraflar (En fazla 5)"}),t.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const r=Array.from(e.target.files);if(r.length+A.length>5)return void b("En fazla 5 gÃ¶rsel yÃ¼kleyebilirsiniz");const t=[...A,...r];z(t);const i=[];t.forEach(e=>{const r=new FileReader;r.onload=e=>{i.push(e.target.result),i.length===t.length&&R(i)},r.readAsDataURL(e)})},style:{marginBottom:"1rem"},disabled:A.length>=5}),T.length>0&&t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"0.75rem"},children:T.map((e,r)=>t.jsxs("div",{style:{position:"relative"},children:[t.jsx("img",{src:e,alt:"Preview "+(r+1),style:{width:"100%",height:"100px",objectFit:"cover",borderRadius:"8px"}}),t.jsx("button",{onClick:()=>(e=>{const r=A.filter((r,t)=>t!==e),t=T.filter((r,t)=>t!==e);z(r),R(t)})(r),style:{position:"absolute",top:"0.25rem",right:"0.25rem",background:"rgba(0, 0, 0, 0.7)",color:"white",border:"none",borderRadius:"50%",width:"24px",height:"24px",cursor:"pointer",fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},children:"Ã—"})]},r))})]}),t.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[t.jsx("button",{onClick:H,style:{padding:"0.75rem 1.5rem",background:"#f1f5f9",color:"#475569",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},disabled:F,children:"Ä°ptal"}),t.jsx("button",{onClick:async()=>{if(E&&I&&I>=1&&5>=I)if(c){L(!0),b("");try{const e=new FormData;e.append("productId",E.productId.toString()),e.append("rating",I.toString()),w.trim()&&e.append("comment",w.trim()),A.forEach((r,t)=>{e.append("images",r)});const r=await fetch(n+"/reviews",{method:"POST",headers:{...c&&{Authorization:"Bearer "+c}},body:e}),t=await r.json();if(!r.ok||!t.isSuccess&&!t.success)throw Error(t.message||"Yorum eklenirken bir hata oluÅŸtu");y("Yorumunuz baÅŸarÄ±yla eklendi!"),H(),setTimeout(()=>{W()},1e3)}catch(e){b(e.message||"Yorum eklenirken bir hata oluÅŸtu")}finally{L(!1)}}else b("GiriÅŸ yapmanÄ±z gerekiyor");else b("LÃ¼tfen 1-5 arasÄ± bir puan seÃ§in")},disabled:F||!I,style:{padding:"0.75rem 1.5rem",background:I?"#667eea":"#cbd5e1",color:"white",border:"none",borderRadius:"8px",cursor:I?"pointer":"not-allowed",fontWeight:"600",opacity:F?.6:1},children:F?"GÃ¶nderiliyor...":"Yorumu GÃ¶nder"})]})]})})]}):null};export{l as default};
