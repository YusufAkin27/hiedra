import{e,u as s,r as i,j as r,L as a}from"./react-vendor-2SZXphvN.js";import{a as n}from"./context-DM-lvtsQ.js";import{S as t}from"./SEO-BxBC3DWO.js";import{L as d}from"./LazyImage-CfhoafY7.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";import"./index-DbqS-Y-U.js";const l="http://localhost:8080/api",c=()=>{const{orderNumber:c}=e(),{user:o,isAuthenticated:m,accessToken:h}=n(),u=s(),[p,g]=i.useState(null),[j,x]=i.useState(!0),[N,b]=i.useState(""),[k,v]=i.useState(!1),[y,E]=i.useState("Ä°ade talebi"),[f,S]=i.useState(!1),[D,A]=i.useState(""),[T,w]=i.useState(null),[R,C]=i.useState(!1);i.useEffect(()=>{m?c&&I():u("/giris")},[c,m,h]);const I=async()=>{if(!o?.email||!c)return b("KullanÄ±cÄ± bilgisi veya sipariÅŸ numarasÄ± bulunamadÄ±"),void x(!1);try{x(!0),b(""),A("");const e=await fetch(l+"/orders/query",{method:"POST",headers:{"Content-Type":"application/json",...h&&{Authorization:"Bearer "+h}},body:JSON.stringify({orderNumber:c,customerEmail:o.email})});if(!e.ok){if(401===e.status)throw Error("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n.");if(404===e.status)throw Error("SipariÅŸ bulunamadÄ±.");{const s=await e.json().catch(()=>({}));throw Error(s.message||`SipariÅŸ yÃ¼klenemedi (${e.status})`)}}const s=await e.json();if(!s.isSuccess&&!s.success)throw Error(s.message||"SipariÅŸ yÃ¼klenemedi");{const e=s.data||s;g({...e,shippingAddress:e.addresses&&e.addresses.length>0?e.addresses[0]:{}}),e.trackingNumber&&L(e.trackingNumber,e.orderNumber)}}catch(e){b(e.message||"SipariÅŸ yÃ¼klenirken bir hata oluÅŸtu")}finally{x(!1)}},L=async(e,s)=>{if(e&&o?.email)try{C(!0);const e=new URL(l+"/shipping/track-by-order");e.searchParams.append("orderNumber",s),e.searchParams.append("email",o.email);const i=await fetch(e.toString(),{method:"GET",headers:{"Content-Type":"application/json",...h&&{Authorization:"Bearer "+h}}}),r=await i.json();(r.isSuccess||r.success)&&w(r.data)}catch(i){}finally{C(!1)}},P=e=>{if(!e)return"";try{return new Date(e).toLocaleString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}};return m?r.jsxs("div",{className:"order-detail-container",children:[r.jsx(t,{title:`SipariÅŸ DetayÄ± - ${c} - Hiedra Perde`,description:c+" numaralÄ± sipariÅŸinizin detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyin",url:"/siparis/"+c}),j?r.jsxs("div",{className:"loading-state",children:[r.jsx("div",{className:"loading-spinner"}),r.jsx("p",{children:"SipariÅŸ yÃ¼kleniyor..."})]}):N&&!p?r.jsxs("div",{className:"error-state",children:[r.jsx("p",{children:N}),r.jsxs("div",{className:"action-buttons",children:[r.jsx("button",{onClick:I,className:"retry-btn",children:"Tekrar Dene"}),r.jsx(a,{to:"/siparislerim",className:"back-btn",children:"SipariÅŸlerime DÃ¶n"})]})]}):p?r.jsxs(r.Fragment,{children:[r.jsx("header",{className:"order-detail-header",children:r.jsxs("div",{className:"header-content",children:[r.jsx(a,{to:"/siparislerim",className:"back-link",children:"â† SipariÅŸlerime DÃ¶n"}),r.jsx("h1",{children:"SipariÅŸ DetayÄ±"})]})}),N&&r.jsx("div",{className:"error-message",children:N}),D&&r.jsx("div",{className:"success-message",children:D}),r.jsxs("div",{className:"order-detail-content",children:[r.jsx("div",{className:"order-summary-card",children:r.jsxs("div",{className:"summary-header",children:[r.jsxs("div",{className:"order-info",children:[r.jsxs("h2",{children:["SipariÅŸ No: ",p.orderNumber]}),r.jsx("span",{className:"status-badge "+(e=>{if(!e)return"status-unknown";const s=e.toUpperCase();return"DELIVERED"===s?"status-delivered":"SHIPPED"===s?"status-shipped":"PROCESSING"===s||"PAID"===s?"status-processing":"CANCELLED"===s||"REFUNDED"===s?"status-cancelled":"REFUND_REQUESTED"===s?"status-refund":"status-pending"})(p.status),children:(F=p.status,F?{PENDING:"Beklemede",PAID:"Ã–dendi",PROCESSING:"HazÄ±rlanÄ±yor",SHIPPED:"Kargoya Verildi",DELIVERED:"Teslim Edildi",CANCELLED:"Ä°ptal Edildi",REFUNDED:"Ä°ade Edildi",REFUND_REQUESTED:"Ä°ade Talebi"}[F.toUpperCase()]||F:"Bilinmiyor")})]}),r.jsxs("div",{className:"order-date",children:[r.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("polyline",{points:"12 6 12 12 16 14"})]}),p.createdAt?new Date(p.createdAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Tarih bilgisi yok"]})]})}),r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"SipariÅŸ ÃœrÃ¼nleri"}),r.jsx("div",{className:"order-items-list",children:p.orderItems&&p.orderItems.length>0?p.orderItems.map((e,s)=>{const i=e.productImageUrl||"/images/perde1kapak.jpg";return r.jsxs("div",{className:"order-item-detail",children:[r.jsx("div",{className:"order-item-image-wrapper-detail",children:r.jsx(d,{src:i,alt:e.productName||"ÃœrÃ¼n",className:"order-item-image-detail"})}),r.jsxs("div",{className:"item-main-info",children:[r.jsx("h4",{children:e.productName||"ÃœrÃ¼n"}),r.jsxs("div",{className:"item-specs",children:[e.width&&e.height&&r.jsxs("span",{className:"spec-item",children:[r.jsx("strong",{children:"Ã–lÃ§Ã¼ler:"})," ",e.width," x ",e.height," cm"]}),e.pleatType&&"1x1"!==e.pleatType&&r.jsxs("span",{className:"spec-item",children:[r.jsx("strong",{children:"Pile Tipi:"})," ",e.pleatType]}),r.jsxs("span",{className:"spec-item",children:[r.jsx("strong",{children:"Adet:"})," ",e.quantity||1]})]})]})]},e.id||s)}):r.jsx("p",{children:"SipariÅŸ detayÄ± bulunamadÄ±"})}),r.jsxs("div",{className:"order-total-section",children:[p.discountAmount&&parseFloat(p.discountAmount)>0&&p.couponCode&&r.jsxs("div",{className:"total-row discount-row",children:[r.jsxs("span",{children:["Kupon Ä°ndirimi (",p.couponCode,"):"]}),r.jsxs("span",{className:"discount-amount",children:["-","string"==typeof p.discountAmount?parseFloat(p.discountAmount).toFixed(2):parseFloat(p.discountAmount.toString()).toFixed(2)," â‚º"]})]}),r.jsxs("div",{className:"total-row final",children:[r.jsx("span",{children:"Toplam:"}),r.jsxs("span",{className:"total-amount",children:[p.totalAmount?"string"==typeof p.totalAmount?parseFloat(p.totalAmount).toFixed(2):parseFloat(p.totalAmount.toString()).toFixed(2):"0.00"," â‚º"]})]})]})]}),r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"Teslimat Adresi"}),r.jsxs("div",{className:"address-details",children:[p.shippingAddress&&r.jsxs(r.Fragment,{children:[p.shippingAddress.addressLine&&r.jsxs("p",{children:[r.jsx("strong",{children:"Adres:"})," ",p.shippingAddress.addressLine]}),p.shippingAddress.addressDetail&&r.jsxs("p",{children:[r.jsx("strong",{children:"Adres DetayÄ±:"})," ",p.shippingAddress.addressDetail]}),(p.shippingAddress.district||p.shippingAddress.city)&&r.jsxs("p",{children:[r.jsx("strong",{children:"Ä°lÃ§e/Åehir:"})," ",p.shippingAddress.district||"",p.shippingAddress.district&&p.shippingAddress.city?" / ":"",p.shippingAddress.city||""]})]}),(!p.shippingAddress||!p.shippingAddress.addressLine&&!p.shippingAddress.city)&&r.jsx("p",{children:"Adres bilgisi bulunamadÄ±"})]})]}),p.trackingNumber&&r.jsxs("div",{className:"order-section tracking-section",children:[r.jsx("h3",{children:"Kargo Takip Bilgileri"}),r.jsxs("div",{className:"tracking-info-card",children:[r.jsxs("div",{className:"tracking-header-info",children:[r.jsxs("div",{className:"tracking-number-info",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Takip NumarasÄ±:"})," ",p.trackingNumber]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Kargo FirmasÄ±:"})," ",p.carrier||"DHL"]}),p.shippedAt&&r.jsxs("p",{children:[r.jsx("strong",{children:"Kargoya Verilme:"})," ",new Date(p.shippedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[r.jsx("button",{onClick:()=>L(p.trackingNumber,p.orderNumber),disabled:R,style:{padding:"0.5rem 1rem",background:R?"#ccc":"#667eea",color:"white",border:"none",borderRadius:"4px",cursor:R?"not-allowed":"pointer",fontSize:"0.9rem",opacity:R?.6:1},children:R?"YÃ¼kleniyor...":"ğŸ”„ GÃ¼ncelle"}),r.jsx(a,{to:`/kargo-takip?trackingNumber=${p.trackingNumber}&orderNumber=${p.orderNumber}`,className:"track-shipment-link",children:"ğŸ“¦ DetaylÄ± Takip"})]})]}),R?r.jsx("div",{className:"tracking-loading",children:r.jsx("p",{children:"Kargo bilgileri yÃ¼kleniyor..."})}):T?r.jsxs("div",{className:"tracking-details",children:[r.jsxs("div",{className:"tracking-status-badge",children:[r.jsx("div",{className:"status-badge "+(e=>{if(!e)return"tracking-status-unknown";const s=e.toUpperCase();return"DELIVERED"===s?"tracking-status-delivered":"IN_TRANSIT"===s||"OUT_FOR_DELIVERY"===s?"tracking-status-transit":"EXCEPTION"===s?"tracking-status-exception":"tracking-status-pending"})(T.status),children:(e=>e?{IN_TRANSIT:"Kargoda",DELIVERED:"Teslim Edildi",EXCEPTION:"Sorun Var",PENDING:"Beklemede",PICKED_UP:"Kargo AlÄ±ndÄ±",OUT_FOR_DELIVERY:"Teslimat Ä°Ã§in Yola Ã‡Ä±ktÄ±"}[e]||e:"Bilinmiyor")(T.status)}),T.statusDescription&&r.jsx("p",{className:"status-description",children:T.statusDescription})]}),T.events&&T.events.length>0&&r.jsxs("div",{className:"tracking-events-preview",children:[r.jsx("h4",{children:"Son Hareketler"}),r.jsxs("div",{className:"events-list",children:[T.events.slice(0,3).map((e,s)=>r.jsxs("div",{className:"event-preview-item",children:[r.jsx("div",{className:"event-time-small",children:P(e.timestamp)}),r.jsxs("div",{className:"event-content-small",children:[e.location&&r.jsx("span",{className:"location-icon",children:"ğŸ“"}),r.jsx("span",{children:e.location||"Konum bilgisi yok"})]}),e.description&&r.jsx("div",{className:"event-description-small",children:e.description})]},s)),T.events.length>3&&r.jsxs(a,{to:`/kargo-takip?trackingNumber=${p.trackingNumber}&orderNumber=${p.orderNumber}`,className:"view-all-events-link",children:["TÃ¼m hareketleri gÃ¶rÃ¼ntÃ¼le (",T.events.length," adet)"]})]})]})]}):r.jsxs("div",{className:"tracking-no-data",children:[r.jsx("p",{children:'Kargo takip bilgisi henÃ¼z gÃ¼ncellenmedi. "GÃ¼ncelle" butonuna tÄ±klayarak en gÃ¼ncel bilgileri alabilirsiniz.'}),r.jsx("button",{onClick:()=>L(p.trackingNumber,p.orderNumber),disabled:R,style:{marginTop:"0.5rem",padding:"0.5rem 1rem",background:R?"#ccc":"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:R?"not-allowed":"pointer",fontSize:"0.9rem",opacity:R?.6:1},children:R?"YÃ¼kleniyor...":"Kargo Bilgisini YÃ¼kle"})]})]})]}),r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"MÃ¼ÅŸteri Bilgileri"}),r.jsxs("div",{className:"customer-details",children:[p.customerName&&r.jsxs("p",{children:[r.jsx("strong",{children:"Ad Soyad:"})," ",p.customerName]}),p.customerEmail&&r.jsxs("p",{children:[r.jsx("strong",{children:"E-posta:"})," ",p.customerEmail]}),p.customerPhone&&r.jsxs("p",{children:[r.jsx("strong",{children:"Telefon:"})," ",p.customerPhone]})]})]}),p.cancelReason&&r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"Ä°ptal Bilgisi"}),r.jsxs("div",{className:"cancel-info",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Sebep:"})," ",p.cancelReason]}),p.cancelledAt&&r.jsxs("p",{children:[r.jsx("strong",{children:"Ä°ptal Tarihi:"})," ",new Date(p.cancelledAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),p.refundedAt&&r.jsxs("div",{className:"order-section",children:[r.jsx("h3",{children:"Ä°ade Bilgisi"}),r.jsx("div",{className:"refund-info",children:r.jsxs("p",{children:[r.jsx("strong",{children:"Ä°ade Tarihi:"})," ",new Date(p.refundedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})})]}),"REFUND_REQUESTED"===p.status&&r.jsxs("div",{className:"order-section info-section",children:[r.jsx("h3",{children:"Ä°ade Talebi"}),r.jsx("div",{className:"refund-request-info",children:r.jsx("p",{children:"Ä°ade talebiniz alÄ±nmÄ±ÅŸtÄ±r ve deÄŸerlendirme aÅŸamasÄ±ndadÄ±r. En kÄ±sa sÃ¼rede size geri dÃ¶nÃ¼ÅŸ yapÄ±lacaktÄ±r."})})]}),(()=>{if(!p||!p.status)return!1;const e=p.status.toUpperCase();return"REFUNDED"!==e&&"REFUND_REQUESTED"!==e})()&&r.jsx("div",{className:"refund-button-section",children:r.jsx("button",{onClick:()=>v(!0),className:"refund-request-btn",disabled:f,children:"Ä°ade Talebi"})})]}),k&&r.jsx("div",{className:"modal-overlay",onClick:()=>!f&&v(!1),children:r.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[r.jsx("h3",{children:"Ä°ade Talebi OluÅŸtur"}),r.jsx("p",{children:"Ä°ade talebi oluÅŸturmak istediÄŸinizden emin misiniz? Ä°ade talebiniz deÄŸerlendirildikten sonra size geri dÃ¶nÃ¼ÅŸ yapÄ±lacaktÄ±r."}),r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{htmlFor:"refundReason",children:["Ä°ade Sebebi ",r.jsx("span",{className:"required",children:"*"})]}),r.jsx("textarea",{id:"refundReason",value:y,onChange:e=>E(e.target.value),rows:"4",placeholder:"LÃ¼tfen iade sebebinizi detaylÄ± olarak aÃ§Ä±klayÄ±n...",required:!0})]}),r.jsxs("div",{className:"modal-actions",children:[r.jsx("button",{onClick:()=>{v(!1),E("Ä°ade talebi"),b("")},disabled:f,className:"cancel-btn",children:"Ä°ptal"}),r.jsx("button",{onClick:async()=>{if(y.trim()){S(!0),b(""),A("");try{const e=await fetch(`${l}/orders/${c}/refund?email=${encodeURIComponent(o.email)}&reason=${encodeURIComponent(y)}`,{method:"POST",headers:{"Content-Type":"application/json",...h&&{Authorization:"Bearer "+h}}}),s=await e.json();if(!e.ok)throw Error(s.message||"Ä°ade talebi oluÅŸturulamadÄ±");if(!s.isSuccess&&!s.success)throw Error(s.message||"Ä°ade talebi oluÅŸturulamadÄ±");A("Ä°ade talebiniz baÅŸarÄ±yla oluÅŸturuldu. En kÄ±sa sÃ¼rede deÄŸerlendirilecektir."),v(!1),E("Ä°ade talebi"),await I()}catch(e){b(e.message||"Ä°ade talebi oluÅŸturulurken bir hata oluÅŸtu")}finally{S(!1)}}else b("LÃ¼tfen iade sebebini belirtin")},disabled:f||!y.trim(),className:"confirm-btn",children:f?"Ä°ÅŸleniyor...":"Ä°ade Talebi OluÅŸtur"})]})]})})]}):null]}):null;var F};export{c as default};
