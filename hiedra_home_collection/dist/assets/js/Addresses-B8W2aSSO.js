import{u as e,r as s,j as a,L as i}from"./react-vendor-DfawjiNX.js";import{a as d}from"./context-BBxaqZSG.js";import"./vendor-invariant-GfE-dftQ.js";import"./vendor-shallowequal-DDPVF0Lr.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BfCtOoOM.js";const n="http://localhost:8080/api",l=()=>{const{isAuthenticated:l,accessToken:r}=d(),t=e(),[c,o]=s.useState([]),[u,h]=s.useState(!0),[m,p]=s.useState(""),[j,x]=s.useState(""),[y,N]=s.useState(null),[f,v]=s.useState({fullName:"",phone:"",addressLine:"",addressDetail:"",city:"",district:"",isDefault:!1});s.useEffect(()=>{l||t("/giris",{state:{from:"/adreslerim"}})},[l,t]),s.useEffect(()=>{l&&r&&b()},[l,r]);const b=async()=>{try{h(!0),p("");const e=await fetch(n+"/user/addresses",{headers:{Authorization:"Bearer "+r,"Content-Type":"application/json"}}),s=await e.json();e.ok&&(s.isSuccess||s.success)?o(s.data||[]):p(s.message||"Adresler yüklenemedi")}catch(e){p("Adresler yüklenirken bir hata oluştu")}finally{h(!1)}},k=e=>{const{name:s,value:a,type:i,checked:d}=e.target;v(e=>({...e,[s]:"checkbox"===i?d:a}))},g=async e=>{e.preventDefault(),p(""),x("");try{const e=y?`${n}/user/addresses/${y.id}`:n+"/user/addresses",s=y?"PUT":"POST",a=await fetch(e,{method:s,headers:{Authorization:"Bearer "+r,"Content-Type":"application/json"},body:JSON.stringify({...f})}),i=await a.json();a.ok&&(i.isSuccess||i.success)?(x(y?"Adres güncellendi":"Adres eklendi"),N(null),D(),b(),setTimeout(()=>x(""),3e3)):p(i.message||"İşlem başarısız")}catch(s){p("Adres kaydedilirken bir hata oluştu")}},D=()=>{v({fullName:"",phone:"",addressLine:"",addressDetail:"",city:"",district:"",isDefault:!1})},A=()=>{N(null),D()};return l?u?a.jsx("div",{className:"addresses-container",children:a.jsxs("div",{className:"loading-state",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Adresler yükleniyor..."})]})}):a.jsxs("div",{className:"addresses-container",children:[a.jsxs("div",{className:"addresses-header",children:[a.jsx("h1",{children:"Adreslerim"}),a.jsxs("div",{className:"header-actions",children:[c.length>0&&a.jsxs("span",{className:"address-count",children:[c.length," / 10 adres"]}),a.jsx(i,{to:"/adres-ekle",className:"btn-add-address "+(10>c.length?"":"disabled"),onClick:e=>{if(c.length>=10)return e.preventDefault(),void p("Maksimum 10 adet adres ekleyebilirsiniz. Lütfen mevcut adreslerinizden birini silin.")},style:{textDecoration:"none",display:"inline-block"},children:"+ Yeni Adres Ekle"})]})]}),m&&a.jsx("div",{className:"alert alert-error",children:m}),j&&a.jsx("div",{className:"alert alert-success",children:j}),0===c.length?a.jsxs("div",{className:"no-addresses",children:[a.jsx("p",{children:"Henüz adres eklenmemiş."}),a.jsx(i,{to:"/adres-ekle",className:"btn-add-address",style:{textDecoration:"none",display:"inline-block"},children:"İlk Adresinizi Ekleyin"})]}):10>c.length?a.jsx("div",{className:"addresses-list",children:c.map(e=>{const s=y&&y.id===e.id;return a.jsx("div",{className:`address-card ${e.isDefault?"default":""} ${s?"address-card-editing":""}`,children:a.jsxs("form",{onSubmit:s?g:e=>e.preventDefault(),className:s?"address-form-inline":"",children:[a.jsxs("div",{className:"address-card-header",children:[e.isDefault&&a.jsx("div",{className:"default-badge",children:"Varsayılan Adres"}),a.jsx("div",{className:"address-card-title",children:s?a.jsxs(a.Fragment,{children:[a.jsx("input",{type:"text",name:"fullName",value:f.fullName,onChange:k,className:"address-input-inline",placeholder:"Ad Soyad",required:!0}),a.jsx("input",{type:"tel",name:"phone",value:f.phone,onChange:k,className:"address-input-inline address-input-phone",placeholder:"Telefon",required:!0})]}):a.jsxs(a.Fragment,{children:[a.jsx("h3",{children:e.fullName}),a.jsx("p",{className:"address-phone",children:e.phone})]})})]}),a.jsxs("div",{className:"address-info",children:[a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label",children:"Adres:"}),s?a.jsx("input",{type:"text",name:"addressLine",value:f.addressLine,onChange:k,className:"address-input-inline",required:!0}):a.jsx("span",{className:"address-value",children:e.addressLine})]}),a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label",children:"Adres Detayı:"}),s?a.jsx("input",{type:"text",name:"addressDetail",value:f.addressDetail,onChange:k,className:"address-input-inline",placeholder:"Daire, Kat vb."}):a.jsx("span",{className:"address-value",children:e.addressDetail||"-"})]}),a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label",children:"Şehir:"}),s?a.jsx("input",{type:"text",name:"city",value:f.city,onChange:k,className:"address-input-inline",required:!0,style:{width:"100%",padding:"0.5rem"}}):a.jsx("span",{className:"address-value",children:e.city})]}),a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label",children:"İlçe:"}),s?a.jsx("input",{type:"text",name:"district",value:f.district,onChange:k,className:"address-input-inline",required:!0,style:{width:"100%",padding:"0.5rem"}}):a.jsx("span",{className:"address-value",children:e.district})]}),s&&a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label"}),a.jsxs("label",{className:"checkbox-inline",children:[a.jsx("input",{type:"checkbox",name:"isDefault",checked:f.isDefault,onChange:k}),a.jsx("span",{children:"Varsayılan adres olarak ayarla"})]})]})]}),a.jsx("div",{className:"address-actions",children:s?a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn-cancel",onClick:A,children:"İptal"}),a.jsx("button",{type:"submit",className:"btn-submit",children:"Güncelle"})]}):a.jsxs(a.Fragment,{children:[!e.isDefault&&a.jsx("button",{type:"button",className:"btn-set-default",onClick:()=>(async e=>{try{p("");const s=c.find(s=>s.id===e);if(!s)return;const a=await fetch(`${n}/user/addresses/${e}`,{method:"PUT",headers:{Authorization:"Bearer "+r,"Content-Type":"application/json"},body:JSON.stringify({...s,isDefault:!0})}),i=await a.json();a.ok&&(i.isSuccess||i.success)?(x("Varsayılan adres güncellendi"),b(),setTimeout(()=>x(""),3e3)):p(i.message||"Varsayılan adres güncellenemedi")}catch(s){p("Varsayılan adres güncellenirken bir hata oluştu")}})(e.id),children:"Varsayılan Yap"}),a.jsx("button",{type:"button",className:"btn-edit",onClick:s=>{s.preventDefault(),s.stopPropagation(),(e=>{N(e),v({fullName:e.fullName||"",phone:e.phone||"",addressLine:e.addressLine||"",addressDetail:e.addressDetail||"",city:e.city||"",district:e.district||"",isDefault:e.isDefault||!1})})(e)},children:"Düzenle"}),a.jsx("button",{type:"button",className:"btn-delete",onClick:()=>(async e=>{if(window.confirm("Bu adresi silmek istediğinize emin misiniz?"))try{p("");const s=await fetch(`${n}/user/addresses/${e}`,{method:"DELETE",headers:{Authorization:"Bearer "+r,"Content-Type":"application/json"}}),a=await s.json();s.ok&&(a.isSuccess||a.success)?(x("Adres silindi"),b(),setTimeout(()=>x(""),3e3)):p(a.message||"Adres silinemedi")}catch(s){p("Adres silinirken bir hata oluştu")}})(e.id),children:"Sil"})]})})]})},e.id)})}):a.jsx("div",{className:"max-addresses-warning",children:a.jsx("p",{children:"Maksimum adres sayısına ulaştınız (10 adet). Yeni adres eklemek için mevcut adreslerinizden birini silin."})})]}):null};export{l as default};
