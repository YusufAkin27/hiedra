import{u as e,r,j as t,L as s}from"./react-vendor-DfawjiNX.js";import{a as i}from"./context-BaHiGFT-.js";import{S as a}from"./SEO-COBDhSYn.js";import{L as o}from"./LazyImage-BHBceM3t.js";import"./vendor-invariant-GfE-dftQ.js";import"./vendor-shallowequal-DDPVF0Lr.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BfCtOoOM.js";import"./index-Zimv_-Zl.js";const n="http://localhost:8080/api",l=()=>{const{user:l,isAuthenticated:d,accessToken:c}=i(),m=e(),[u,p]=r.useState([]),[h,g]=r.useState(!0),[N,x]=r.useState(""),[b,j]=r.useState(""),[y,f]=r.useState({}),[E,k]=r.useState({});r.useEffect(()=>{d?v():m("/giris")},[d,l,c]),r.useEffect(()=>{u.length>0&&l?.email&&u.forEach(e=>{!e.trackingNumber||y[e.orderNumber]||E[e.orderNumber]||A(e)})},[u,l?.email]);const v=async()=>{if(!l?.email)return x("KullanÄ±cÄ± bilgisi bulunamadÄ±"),void g(!1);try{g(!0),x("");const e=await fetch(n+"/orders/my-orders",{method:"GET",headers:{"Content-Type":"application/json",...c&&{Authorization:"Bearer "+c}}});if(!e.ok){if(401===e.status)throw Error("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n.");if(404===e.status)return void p([]);{const r=await e.json().catch(()=>({}));throw Error(r.message||`SipariÅŸler yÃ¼klenemedi (${e.status})`)}}const r=await e.json();if(r.isSuccess||r.success){const e=r.data||[];p(e)}else p([]),x(r.message||"SipariÅŸler yÃ¼klenemedi")}catch(e){x(e.message||"SipariÅŸler yÃ¼klenirken bir hata oluÅŸtu")}finally{g(!1)}},S=e=>{if(!e)return"status-unknown";const r=e.toUpperCase();return"DELIVERED"===r?"status-delivered":"SHIPPED"===r?"status-shipped":"PROCESSING"===r||"PAID"===r?"status-processing":"CANCELLED"===r||"REFUNDED"===r?"status-cancelled":"REFUND_REQUESTED"===r?"status-refund":"status-pending"},A=async e=>{if(!e.trackingNumber||!l?.email)return;const r=e.orderNumber;if(!E[r]&&!y[r])try{k(e=>({...e,[r]:!0}));const t=new URL(n+"/shipping/track-by-order");t.searchParams.append("orderNumber",e.orderNumber),t.searchParams.append("email",l.email);const s=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json",...c&&{Authorization:"Bearer "+c}}}),i=await s.json();(i.isSuccess||i.success)&&f(e=>({...e,[r]:i.data}))}catch(t){}finally{k(e=>({...e,[r]:!1}))}},D=e=>e?{IN_TRANSIT:"Kargoda",DELIVERED:"Teslim Edildi",EXCEPTION:"Sorun Var",PENDING:"Beklemede",PICKED_UP:"Kargo AlÄ±ndÄ±",OUT_FOR_DELIVERY:"Teslimat Ä°Ã§in Yola Ã‡Ä±ktÄ±"}[e.toUpperCase()]||e:"Bilinmiyor";return d?t.jsxs("div",{className:"my-orders-container",children:[t.jsx(a,{title:"SipariÅŸlerim - Hiedra Perde",description:"SipariÅŸlerinizi gÃ¶rÃ¼ntÃ¼leyin ve takip edin",url:"/siparislerim"}),t.jsxs("header",{className:"my-orders-header",children:[t.jsx("h1",{children:"SipariÅŸlerim"}),t.jsx("p",{children:"TÃ¼m sipariÅŸlerinizi buradan gÃ¶rÃ¼ntÃ¼leyebilir ve takip edebilirsiniz"})]}),N&&!h&&t.jsx("div",{className:"error-message",style:{margin:"1rem",padding:"1rem",backgroundColor:"#fee",color:"#c33",borderRadius:"4px"},children:N}),b&&t.jsx("div",{className:"success-message",style:{margin:"1rem",padding:"1rem",backgroundColor:"#efe",color:"#3c3",borderRadius:"4px"},children:b}),h?t.jsxs("div",{className:"loading-state",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{children:"SipariÅŸler yÃ¼kleniyor..."})]}):N&&0===u.length?t.jsxs("div",{className:"error-state",children:[t.jsx("p",{children:N}),t.jsx("button",{onClick:v,className:"retry-btn",children:"Tekrar Dene"})]}):0===u.length?t.jsxs("div",{className:"empty-state",children:[t.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M9 2L7 6m6-4l2 4M3 8h18l-1 8H4L3 8z"}),t.jsx("circle",{cx:"7",cy:"20",r:"2"}),t.jsx("circle",{cx:"17",cy:"20",r:"2"})]}),t.jsx("h2",{children:"HenÃ¼z sipariÅŸiniz yok"}),t.jsx("p",{children:"Ä°lk sipariÅŸinizi vermek iÃ§in Ã¼rÃ¼nlerimizi inceleyin"}),t.jsx(s,{to:"/",className:"shop-btn",children:"AlÄ±ÅŸveriÅŸe BaÅŸla"})]}):t.jsx("div",{className:"orders-list",children:u.map(e=>{return t.jsxs("div",{className:"order-card",children:[t.jsxs("div",{className:"order-card-header",children:[t.jsxs("div",{className:"order-info",children:[t.jsxs("h3",{children:["SipariÅŸ No: ",e.orderNumber]}),t.jsx("span",{className:"status-badge "+S(e.status),children:(r=e.status,r?{PENDING:"Beklemede",PAID:"Ã–dendi",PROCESSING:"HazÄ±rlanÄ±yor",SHIPPED:"Kargoya Verildi",DELIVERED:"Teslim Edildi",CANCELLED:"Ä°ptal Edildi",REFUNDED:"Ä°ade Edildi",REFUND_REQUESTED:"Ä°ade Talebi"}[r.toUpperCase()]||r:"Bilinmiyor")})]}),t.jsxs("div",{className:"order-date",children:[t.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("polyline",{points:"12 6 12 12 16 14"})]}),e.createdAt?new Date(e.createdAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Tarih bilgisi yok"]})]}),t.jsx("div",{className:"order-items-preview",children:e.orderItems&&e.orderItems.length>0?t.jsx(t.Fragment,{children:e.orderItems.map((e,r)=>{let s=e.productImageUrl||"/images/perde1kapak.jpg";return s&&""!==s&&"null"!==s&&"undefined"!==s||(s="/images/perde1kapak.jpg"),s.startsWith("http")||s.startsWith("/")||(s="/"+s),t.jsxs("div",{className:"order-item-preview",children:[t.jsx("div",{className:"order-item-image-wrapper",children:t.jsx(o,{src:s,alt:e.productName||"ÃœrÃ¼n",className:"order-item-image"})}),t.jsxs("div",{className:"order-item-info",children:[t.jsx("span",{className:"item-name",children:e.productName||"ÃœrÃ¼n"}),e.quantity>1&&t.jsxs("span",{className:"item-quantity",children:["Adet: ",e.quantity]})]})]},e.id||r)})}):t.jsx("p",{className:"no-items-text",children:"SipariÅŸ detayÄ± bulunamadÄ±"})}),e.trackingNumber&&t.jsxs("div",{className:"order-tracking-section",style:{padding:"1rem",marginTop:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e0e0e0"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Kargo Takip:"})," ",e.trackingNumber,e.carrier&&t.jsxs("span",{style:{marginLeft:"0.5rem",color:"#64748b"},children:["(",e.carrier,")"]})]}),t.jsx("button",{onClick:()=>A(e),disabled:E[e.orderNumber],style:{padding:"0.25rem 0.75rem",background:"#667eea",color:"white",border:"none",borderRadius:"4px",cursor:E[e.orderNumber]?"not-allowed":"pointer",fontSize:"0.85rem",opacity:E[e.orderNumber]?.6:1},children:E[e.orderNumber]?"YÃ¼kleniyor...":"GÃ¼ncelle"})]}),y[e.orderNumber]?t.jsxs("div",{style:{marginTop:"0.75rem"},children:[t.jsx("div",{style:{display:"inline-block",padding:"0.25rem 0.75rem",borderRadius:"4px",fontSize:"0.9rem",fontWeight:"600",backgroundColor:"DELIVERED"===y[e.orderNumber].status?"#d4edda":"IN_TRANSIT"===y[e.orderNumber].status?"#d1ecf1":"EXCEPTION"===y[e.orderNumber].status?"#f8d7da":"#fff3cd",color:"DELIVERED"===y[e.orderNumber].status?"#155724":"IN_TRANSIT"===y[e.orderNumber].status?"#0c5460":"EXCEPTION"===y[e.orderNumber].status?"#721c24":"#856404"},children:D(y[e.orderNumber].status)}),y[e.orderNumber].statusDescription&&t.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.9rem",color:"#64748b"},children:y[e.orderNumber].statusDescription}),y[e.orderNumber].events&&y[e.orderNumber].events.length>0&&t.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.85rem",color:"#64748b"},children:[t.jsx("strong",{children:"Son Hareket:"})," ",y[e.orderNumber].events[0].description||"Bilgi yok",y[e.orderNumber].events[0].location&&t.jsxs("span",{style:{marginLeft:"0.5rem"},children:["ðŸ“ ",y[e.orderNumber].events[0].location]})]}),t.jsx(s,{to:`/kargo-takip?trackingNumber=${e.trackingNumber}&orderNumber=${e.orderNumber}`,style:{display:"inline-block",marginTop:"0.75rem",color:"#667eea",textDecoration:"none",fontSize:"0.9rem",fontWeight:"600"},children:"â†’ DetaylÄ± Takip Bilgisi"})]}):t.jsx(s,{to:`/kargo-takip?trackingNumber=${e.trackingNumber}&orderNumber=${e.orderNumber}`,style:{display:"inline-block",marginTop:"0.5rem",color:"#667eea",textDecoration:"none",fontSize:"0.9rem",fontWeight:"600"},children:"â†’ Kargo Durumunu GÃ¶rÃ¼ntÃ¼le"})]}),t.jsxs("div",{className:"order-card-footer",children:[t.jsxs("div",{className:"order-total",children:[t.jsx("span",{children:"Toplam:"}),t.jsxs("span",{className:"total-amount",children:[(()=>{if(void 0!==e.totalAmount&&null!==e.totalAmount){const r="string"==typeof e.totalAmount?parseFloat(e.totalAmount):parseFloat(e.totalAmount.toString());if(!isNaN(r)&&r>0)return r.toFixed(2)}if(e.orderItems&&e.orderItems.length>0){let r=0;if(e.orderItems.forEach(e=>{const t=e.price?"string"==typeof e.price?parseFloat(e.price):parseFloat(e.price.toString()):0,s=e.quantity||1;r+=t*s}),r>0){const t=e.shippingCost&&null!==e.shippingCost?"string"==typeof e.shippingCost?parseFloat(e.shippingCost):parseFloat(e.shippingCost.toString()):0,s=e.discountAmount&&null!==e.discountAmount?"string"==typeof e.discountAmount?parseFloat(e.discountAmount):parseFloat(e.discountAmount.toString()):0,i=e.taxAmount&&null!==e.taxAmount?"string"==typeof e.taxAmount?parseFloat(e.taxAmount):parseFloat(e.taxAmount.toString()):0,a=r+t-s+i;return a>0?a.toFixed(2):r.toFixed(2)}}if(void 0!==e.subtotal&&null!==e.subtotal){const r="string"==typeof e.subtotal?parseFloat(e.subtotal):parseFloat(e.subtotal.toString());if(!isNaN(r)&&r>0){const t=r+(e.shippingCost&&null!==e.shippingCost?"string"==typeof e.shippingCost?parseFloat(e.shippingCost):parseFloat(e.shippingCost.toString()):0)-(e.discountAmount&&null!==e.discountAmount?"string"==typeof e.discountAmount?parseFloat(e.discountAmount):parseFloat(e.discountAmount.toString()):0)+(e.taxAmount&&null!==e.taxAmount?"string"==typeof e.taxAmount?parseFloat(e.taxAmount):parseFloat(e.taxAmount.toString()):0);return t>0?t.toFixed(2):r.toFixed(2)}}return"0.00"})()," â‚º"]})]}),t.jsx("div",{className:"order-actions",children:t.jsx(s,{to:"/siparis/"+e.orderNumber,className:"view-order-btn",children:"DetaylarÄ± GÃ¶r"})})]})]},e.id||e.orderNumber);var r})})]}):null};export{l as default};
