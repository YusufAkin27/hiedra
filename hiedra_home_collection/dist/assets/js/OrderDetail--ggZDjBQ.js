import{e,u as r,r as i,j as s,L as t}from"./react-vendor-2SZXphvN.js";import{a}from"./context-DM-lvtsQ.js";import{S as n}from"./SEO-BxBC3DWO.js";import{L as o}from"./LazyImage-h5YRuMlr.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";import"./index-BEt6J7BY.js";const d="http://localhost:8080/api",l=()=>{const{orderNumber:l}=e(),{user:c,isAuthenticated:m,accessToken:u,logout:p}=a(),h=r(),[g,x]=i.useState(null),[f,b]=i.useState(!0),[y,j]=i.useState(""),[k,v]=i.useState(!1),[N,E]=i.useState("Ä°ade talebi"),[S,T]=i.useState(!1),[D,I]=i.useState(""),[w,z]=i.useState(null),[A,L]=i.useState(!1),[R,C]=i.useState(null),[B,P]=i.useState(0),[F,U]=i.useState(""),[O,M]=i.useState([]),[_,Y]=i.useState([]),[K,W]=i.useState(!1),[$,G]=i.useState({});i.useEffect(()=>{m?l&&H():h("/giris")},[l,m,u]);const H=async()=>{if(!c?.email||!l)return j("KullanÄ±cÄ± bilgisi veya sipariÅŸ numarasÄ± bulunamadÄ±"),void b(!1);try{b(!0),j(""),I("");const e=await fetch(d+"/orders/query",{method:"POST",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer "+u}},body:JSON.stringify({orderNumber:l,customerEmail:c.email})});if(!e.ok){if(401===e.status)return p(),j("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n."),void setTimeout(()=>{h("/giris",{state:{returnTo:"/siparis/"+l}})},1500);if(404===e.status)throw Error("SipariÅŸ bulunamadÄ±.");{const r=await e.json().catch(()=>({}));throw Error(r.message||`SipariÅŸ yÃ¼klenemedi (${e.status})`)}}const r=await e.json();if(!r.isSuccess&&!r.success)throw Error(r.message||"SipariÅŸ yÃ¼klenemedi");{const e=r.data||r;x({...e,shippingAddress:e.addresses&&e.addresses.length>0?e.addresses[0]:{}}),e.trackingNumber&&V(e.trackingNumber,e.orderNumber),"DELIVERED"!==e.status&&"TESLIM_EDILDI"!==e.status||!e.orderItems||Q(e.orderItems)}}catch(e){j(e.message||"SipariÅŸ yÃ¼klenirken bir hata oluÅŸtu")}finally{b(!1)}},V=async(e,r)=>{if(e&&c?.email)try{L(!0);const e=new URL(d+"/shipping/track-by-order");e.searchParams.append("orderNumber",r),e.searchParams.append("email",c.email);const i=await fetch(e.toString(),{method:"GET",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer "+u}}}),s=await i.json();(s.isSuccess||s.success)&&z(s.data)}catch(i){}finally{L(!1)}},q=e=>{if(!e)return"";try{return new Date(e).toLocaleString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}},Q=async e=>{if(!e||!e.length||!u)return void G({});const r={},i=new Set;for(const t of e)t.productId&&i.add(t.productId);const s=Array.from(i).map(async e=>{try{const r=await fetch(`${d}/reviews/product/${e}/has-reviewed`,{headers:{Authorization:"Bearer "+u}});if(r.ok){const i=await r.json();if(i.isSuccess&&!0===i.data)return{productId:e,hasReviewed:!0}}}catch(r){}return{productId:e,hasReviewed:!1}});(await Promise.all(s)).forEach(({productId:e,hasReviewed:i})=>{i&&(r[e]=!0)}),G(r)},X=()=>{C(null),P(0),U(""),M([]),Y([])};return m?s.jsxs("div",{className:"order-detail-container",children:[s.jsx(n,{title:`SipariÅŸ DetayÄ± - ${l} - Hiedra Perde`,description:l+" numaralÄ± sipariÅŸinizin detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyin",url:"/siparis/"+l}),f?s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"SipariÅŸ yÃ¼kleniyor..."})]}):y&&!g?s.jsxs("div",{className:"error-state",children:[s.jsx("p",{children:y}),s.jsxs("div",{className:"action-buttons",children:[s.jsx("button",{onClick:H,className:"retry-btn",children:"Tekrar Dene"}),s.jsx(t,{to:"/siparislerim",className:"back-btn",children:"SipariÅŸlerime DÃ¶n"})]})]}):g?s.jsxs(s.Fragment,{children:[s.jsx("header",{className:"order-detail-header",children:s.jsxs("div",{className:"header-content",children:[s.jsx(t,{to:"/siparislerim",className:"back-link",children:"â† SipariÅŸlerime DÃ¶n"}),s.jsx("h1",{children:"SipariÅŸ DetayÄ±"})]})}),y&&s.jsx("div",{className:"error-message",children:y}),D&&s.jsx("div",{className:"success-message",children:D}),s.jsxs("div",{className:"order-detail-content",children:[s.jsx("div",{className:"order-summary-card",children:s.jsxs("div",{className:"summary-header",children:[s.jsxs("div",{className:"order-info",children:[s.jsxs("h2",{children:["SipariÅŸ No: ",g.orderNumber]}),s.jsx("span",{className:"status-badge "+(e=>{if(!e)return"status-unknown";const r=e.toUpperCase();return"DELIVERED"===r||"TESLIM_EDILDI"===r?"status-delivered":"SHIPPED"===r||"KARGOYA_VERILDI"===r?"status-shipped":"PROCESSING"===r||"PAID"===r||"ISLEME_ALINDI"===r||"ODENDI"===r?"status-processing":"CANCELLED"===r||"REFUNDED"===r||"IPTAL_EDILDI"===r||"IADE_YAPILDI"===r?"status-cancelled":"REFUND_REQUESTED"===r||"IADE_TALEP_EDILDI"===r?"status-refund":"status-pending"})(g.status),children:(J=g.status,J?{PENDING:"Beklemede",PAID:"Ã–dendi",PROCESSING:"HazÄ±rlanÄ±yor",SHIPPED:"Kargoya Verildi",DELIVERED:"Teslim Edildi",TESLIM_EDILDI:"Teslim Edildi",CANCELLED:"Ä°ptal Edildi",REFUNDED:"Ä°ade Edildi",REFUND_REQUESTED:"Ä°ade Talebi"}[J.toUpperCase()]||J:"Bilinmiyor")})]}),s.jsxs("div",{className:"order-date",children:[s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("polyline",{points:"12 6 12 12 16 14"})]}),g.createdAt?new Date(g.createdAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Tarih bilgisi yok"]})]})}),s.jsxs("div",{className:"order-section",children:[s.jsx("h3",{children:"SipariÅŸ ÃœrÃ¼nleri"}),s.jsx("div",{className:"order-items-list",children:g.orderItems&&g.orderItems.length>0?g.orderItems.map((e,r)=>{const i=e.productImageUrl||"/images/perde1kapak.jpg",t=("DELIVERED"===g.status||"TESLIM_EDILDI"===g.status)&&e.productId,a=$[e.productId];return s.jsxs("div",{className:"order-item-detail",children:[s.jsx("div",{className:"order-item-image-wrapper-detail",children:s.jsx(o,{src:i,alt:e.productName||"ÃœrÃ¼n",className:"order-item-image-detail"})}),s.jsxs("div",{className:"item-main-info",children:[s.jsx("h4",{children:e.productName||"ÃœrÃ¼n"}),s.jsxs("div",{className:"item-specs",children:[e.width&&e.height&&s.jsxs("span",{className:"spec-item",children:[s.jsx("strong",{children:"Ã–lÃ§Ã¼ler:"})," ",e.width," x ",e.height," cm"]}),e.pleatType&&"1x1"!==e.pleatType&&s.jsxs("span",{className:"spec-item",children:[s.jsx("strong",{children:"Pile Tipi:"})," ",e.pleatType]}),s.jsxs("span",{className:"spec-item",children:[s.jsx("strong",{children:"Adet:"})," ",e.quantity||1]})]}),t&&!a&&s.jsx("button",{onClick:()=>((e,r,i)=>{$[e]?j("Bu Ã¼rÃ¼ne zaten yorum yaptÄ±nÄ±z. Her Ã¼rÃ¼ne sadece bir kez yorum yapabilirsiniz."):(C({productId:e,productName:r,productImage:i}),P(0),U(""),M([]),Y([]),j(""))})(e.productId,e.productName,i),className:"review-btn",style:{marginTop:"0.75rem",padding:"0.5rem 1rem",background:"#667eea",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",transition:"all 0.2s"},title:"Bu Ã¼rÃ¼ne yorum yap",children:"Yorum Yap"})]})]},e.id||r)}):s.jsx("p",{children:"SipariÅŸ detayÄ± bulunamadÄ±"})}),s.jsxs("div",{className:"order-total-section",children:[g.discountAmount&&parseFloat(g.discountAmount)>0&&g.couponCode&&s.jsxs("div",{className:"total-row discount-row",children:[s.jsxs("span",{children:["Kupon Ä°ndirimi (",g.couponCode,"):"]}),s.jsxs("span",{className:"discount-amount",children:["-","string"==typeof g.discountAmount?parseFloat(g.discountAmount).toFixed(2):parseFloat(g.discountAmount.toString()).toFixed(2)," â‚º"]})]}),s.jsxs("div",{className:"total-row final",children:[s.jsx("span",{children:"Toplam:"}),s.jsxs("span",{className:"total-amount",children:[g.totalAmount?"string"==typeof g.totalAmount?parseFloat(g.totalAmount).toFixed(2):parseFloat(g.totalAmount.toString()).toFixed(2):"0.00"," â‚º"]})]})]})]}),s.jsxs("div",{className:"order-section",children:[s.jsx("h3",{children:"Teslimat Adresi"}),s.jsxs("div",{className:"address-details",children:[g.shippingAddress&&s.jsxs(s.Fragment,{children:[g.shippingAddress.addressLine&&s.jsxs("p",{children:[s.jsx("strong",{children:"Adres:"})," ",g.shippingAddress.addressLine]}),g.shippingAddress.addressDetail&&s.jsxs("p",{children:[s.jsx("strong",{children:"Adres DetayÄ±:"})," ",g.shippingAddress.addressDetail]}),(g.shippingAddress.district||g.shippingAddress.city)&&s.jsxs("p",{children:[s.jsx("strong",{children:"Ä°lÃ§e/Åehir:"})," ",g.shippingAddress.district||"",g.shippingAddress.district&&g.shippingAddress.city?" / ":"",g.shippingAddress.city||""]})]}),(!g.shippingAddress||!g.shippingAddress.addressLine&&!g.shippingAddress.city)&&s.jsx("p",{children:"Adres bilgisi bulunamadÄ±"})]})]}),g.trackingNumber&&s.jsxs("div",{className:"order-section tracking-section",children:[s.jsx("h3",{children:"Kargo Takip Bilgileri"}),s.jsxs("div",{className:"tracking-info-card",children:[s.jsxs("div",{className:"tracking-header-info",children:[s.jsxs("div",{className:"tracking-number-info",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Takip NumarasÄ±:"})," ",g.trackingNumber]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Kargo FirmasÄ±:"})," ",g.carrier||"DHL"]}),g.shippedAt&&s.jsxs("p",{children:[s.jsx("strong",{children:"Kargoya Verilme:"})," ",new Date(g.shippedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),s.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[s.jsx("button",{onClick:()=>V(g.trackingNumber,g.orderNumber),disabled:A,style:{padding:"0.5rem 1rem",background:A?"#ccc":"#667eea",color:"white",border:"none",borderRadius:"4px",cursor:A?"not-allowed":"pointer",fontSize:"0.9rem",opacity:A?.6:1},children:A?"YÃ¼kleniyor...":"ğŸ”„ GÃ¼ncelle"}),s.jsx(t,{to:`/kargo-takip?trackingNumber=${g.trackingNumber}&orderNumber=${g.orderNumber}`,className:"track-shipment-link",children:"ğŸ“¦ DetaylÄ± Takip"})]})]}),A?s.jsx("div",{className:"tracking-loading",children:s.jsx("p",{children:"Kargo bilgileri yÃ¼kleniyor..."})}):w?s.jsxs("div",{className:"tracking-details",children:[s.jsxs("div",{className:"tracking-status-badge",children:[s.jsx("div",{className:"status-badge "+(e=>{if(!e)return"tracking-status-unknown";const r=e.toUpperCase();return"DELIVERED"===r?"tracking-status-delivered":"IN_TRANSIT"===r||"OUT_FOR_DELIVERY"===r?"tracking-status-transit":"EXCEPTION"===r?"tracking-status-exception":"tracking-status-pending"})(w.status),children:(e=>e?{IN_TRANSIT:"Kargoda",DELIVERED:"Teslim Edildi",EXCEPTION:"Sorun Var",PENDING:"Beklemede",PICKED_UP:"Kargo AlÄ±ndÄ±",OUT_FOR_DELIVERY:"Teslimat Ä°Ã§in Yola Ã‡Ä±ktÄ±"}[e]||e:"Bilinmiyor")(w.status)}),w.statusDescription&&s.jsx("p",{className:"status-description",children:w.statusDescription})]}),w.events&&w.events.length>0&&s.jsxs("div",{className:"tracking-events-preview",children:[s.jsx("h4",{children:"Son Hareketler"}),s.jsxs("div",{className:"events-list",children:[w.events.slice(0,3).map((e,r)=>s.jsxs("div",{className:"event-preview-item",children:[s.jsx("div",{className:"event-time-small",children:q(e.timestamp)}),s.jsxs("div",{className:"event-content-small",children:[e.location&&s.jsx("span",{className:"location-icon",children:"ğŸ“"}),s.jsx("span",{children:e.location||"Konum bilgisi yok"})]}),e.description&&s.jsx("div",{className:"event-description-small",children:e.description})]},r)),w.events.length>3&&s.jsxs(t,{to:`/kargo-takip?trackingNumber=${g.trackingNumber}&orderNumber=${g.orderNumber}`,className:"view-all-events-link",children:["TÃ¼m hareketleri gÃ¶rÃ¼ntÃ¼le (",w.events.length," adet)"]})]})]})]}):s.jsxs("div",{className:"tracking-no-data",children:[s.jsx("p",{children:'Kargo takip bilgisi henÃ¼z gÃ¼ncellenmedi. "GÃ¼ncelle" butonuna tÄ±klayarak en gÃ¼ncel bilgileri alabilirsiniz.'}),s.jsx("button",{onClick:()=>V(g.trackingNumber,g.orderNumber),disabled:A,style:{marginTop:"0.5rem",padding:"0.5rem 1rem",background:A?"#ccc":"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:A?"not-allowed":"pointer",fontSize:"0.9rem",opacity:A?.6:1},children:A?"YÃ¼kleniyor...":"Kargo Bilgisini YÃ¼kle"})]})]})]}),s.jsxs("div",{className:"order-section",children:[s.jsx("h3",{children:"MÃ¼ÅŸteri Bilgileri"}),s.jsxs("div",{className:"customer-details",children:[g.customerName&&s.jsxs("p",{children:[s.jsx("strong",{children:"Ad Soyad:"})," ",g.customerName]}),g.customerEmail&&s.jsxs("p",{children:[s.jsx("strong",{children:"E-posta:"})," ",g.customerEmail]}),g.customerPhone&&s.jsxs("p",{children:[s.jsx("strong",{children:"Telefon:"})," ",g.customerPhone]})]})]}),g.cancelReason&&s.jsxs("div",{className:"order-section",children:[s.jsx("h3",{children:"Ä°ptal Bilgisi"}),s.jsxs("div",{className:"cancel-info",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Sebep:"})," ",g.cancelReason]}),g.cancelledAt&&s.jsxs("p",{children:[s.jsx("strong",{children:"Ä°ptal Tarihi:"})," ",new Date(g.cancelledAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),g.refundedAt&&s.jsxs("div",{className:"order-section",children:[s.jsx("h3",{children:"Ä°ade Bilgisi"}),s.jsx("div",{className:"refund-info",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Ä°ade Tarihi:"})," ",new Date(g.refundedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})})]}),"REFUND_REQUESTED"===g.status&&s.jsxs("div",{className:"order-section info-section",children:[s.jsx("h3",{children:"Ä°ade Talebi"}),s.jsx("div",{className:"refund-request-info",children:s.jsx("p",{children:"Ä°ade talebiniz alÄ±nmÄ±ÅŸtÄ±r ve deÄŸerlendirme aÅŸamasÄ±ndadÄ±r. En kÄ±sa sÃ¼rede size geri dÃ¶nÃ¼ÅŸ yapÄ±lacaktÄ±r."})})]}),(()=>{if(!g||!g.status)return!1;const e=g.status.toUpperCase();return"REFUNDED"!==e&&"REFUND_REQUESTED"!==e})()&&s.jsx("div",{className:"refund-button-section",children:s.jsx("button",{onClick:()=>v(!0),className:"refund-request-btn",disabled:S,children:"Ä°ade Talebi"})})]}),R&&s.jsx("div",{className:"review-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"1rem",animation:"fadeIn 0.2s ease-out"},onClick:X,children:s.jsxs("div",{className:"review-modal",style:{background:"white",borderRadius:"20px",padding:0,maxWidth:"650px",width:"100%",maxHeight:"90vh",overflow:"hidden",boxShadow:"0 25px 80px rgba(0, 0, 0, 0.4)",display:"flex",flexDirection:"column",animation:"slideUp 0.3s ease-out"},onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{style:{background:"#ffffff",padding:"1.5rem 2rem",borderBottom:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("h2",{style:{margin:0,fontSize:"1.5rem",fontWeight:"600",color:"#1f2937"},children:"ÃœrÃ¼n Yorumu"}),s.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.875rem",color:"#6b7280"},children:"Deneyiminizi paylaÅŸÄ±n"})]}),s.jsx("button",{onClick:X,style:{background:"#f3f4f6",border:"none",borderRadius:"50%",width:"32px",height:"32px",cursor:"pointer",color:"#6b7280",fontSize:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",lineHeight:1},onMouseEnter:e=>{e.currentTarget.style.background="#e5e7eb",e.currentTarget.style.color="#374151"},onMouseLeave:e=>{e.currentTarget.style.background="#f3f4f6",e.currentTarget.style.color="#6b7280"},children:"Ã—"})]}),s.jsxs("div",{style:{padding:"2rem",overflowY:"auto",flex:1},children:[s.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"2rem",padding:"1rem",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[s.jsx("img",{src:R.productImage,alt:R.productName,style:{width:"80px",height:"80px",objectFit:"cover",borderRadius:"8px",border:"1px solid #e5e7eb"}}),s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[s.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600",color:"#1f2937",marginBottom:"0.25rem"},children:R.productName}),s.jsx("p",{style:{margin:0,fontSize:"0.8125rem",color:"#9ca3af"},children:"ÃœrÃ¼n hakkÄ±ndaki gÃ¶rÃ¼ÅŸleriniz bizim iÃ§in deÄŸerli"})]})]}),s.jsxs("div",{style:{marginBottom:"2rem"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"1rem",fontWeight:"600",fontSize:"0.9375rem",color:"#374151"},children:["PuanÄ±nÄ±z ",s.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),s.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-start",alignItems:"center",padding:"1rem",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[[1,2,3,4,5].map(e=>s.jsx("button",{type:"button",onClick:()=>P(e),style:{background:"none",border:"none",cursor:"pointer",padding:"0.25rem",transition:"transform 0.15s",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:s.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:e>B?"none":"#fbbf24",stroke:e>B?"#d1d5db":"#f59e0b",strokeWidth:"1.5",style:{transition:"all 0.2s"},children:s.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})},e)),B>0&&s.jsx("span",{style:{marginLeft:"1rem",fontSize:"0.875rem",color:"#6b7280",fontWeight:"500"},children:5===B?"MÃ¼kemmel":4===B?"Ã‡ok Ä°yi":3===B?"Ä°yi":2===B?"Orta":"KÃ¶tÃ¼"})]})]}),s.jsxs("div",{style:{marginBottom:"2rem"},children:[s.jsx("label",{style:{display:"block",marginBottom:"0.75rem",fontWeight:"600",fontSize:"0.9375rem",color:"#374151"},children:"Yorumunuz"}),s.jsx("textarea",{value:F,onChange:e=>U(e.target.value),rows:"6",style:{width:"100%",padding:"0.875rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"0.875rem",fontFamily:"inherit",resize:"vertical",transition:"all 0.2s",lineHeight:"1.5",color:"#1f2937",background:"#ffffff"},onFocus:e=>e.currentTarget.style.borderColor="#9ca3af",onBlur:e=>e.currentTarget.style.borderColor="#d1d5db",placeholder:"ÃœrÃ¼n hakkÄ±ndaki dÃ¼ÅŸÃ¼ncelerinizi paylaÅŸÄ±n...",maxLength:2e3}),s.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:F.length>1900?"#ef4444":"#9ca3af",textAlign:"right",fontWeight:F.length>1900?"600":"400"},children:[F.length,"/2000 karakter"]})]}),s.jsxs("div",{style:{marginBottom:"2rem"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"0.75rem",fontWeight:"600",fontSize:"0.9375rem",color:"#374151"},children:["FotoÄŸraflar ",s.jsx("span",{style:{fontWeight:"400",color:"#9ca3af",fontSize:"0.8125rem"},children:"(Opsiyonel, en fazla 5)"})]}),s.jsxs("div",{style:{border:"1px dashed #d1d5db",borderRadius:"8px",padding:"1rem",textAlign:"center",background:"#f9fafb",transition:"all 0.2s",marginBottom:"1rem"},onDragOver:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#9ca3af",e.currentTarget.style.background="#f3f4f6"},onDragLeave:e=>{e.currentTarget.style.borderColor="#d1d5db",e.currentTarget.style.background="#f9fafb"},children:[s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const r=Array.from(e.target.files);if(r.length+O.length>5)return void j("En fazla 5 gÃ¶rsel yÃ¼kleyebilirsiniz");const i=[...O,...r];M(i);const s=[];r.forEach(e=>{const r=new FileReader;r.onload=e=>{s.push(e.target.result),s.length===i.length&&Y(s)},r.readAsDataURL(e)})},disabled:O.length>=5,style:{width:"100%",padding:"0.625rem",border:"1px solid #d1d5db",borderRadius:"6px",background:5>O.length?"white":"#f3f4f6",cursor:5>O.length?"pointer":"not-allowed",fontSize:"0.8125rem",color:"#374151"}}),O.length>=5&&s.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.75rem",color:"#ef4444"},children:"Maksimum 5 fotoÄŸraf yÃ¼kleyebilirsiniz"})]}),_.length>0&&s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"1rem"},children:_.map((e,r)=>s.jsxs("div",{style:{position:"relative",borderRadius:"8px",overflow:"hidden",border:"1px solid #e5e7eb",transition:"transform 0.2s"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.02)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:[s.jsx("img",{src:e,alt:"Preview "+(r+1),style:{width:"100%",height:"100px",objectFit:"cover",display:"block"}}),s.jsx("button",{type:"button",onClick:()=>(e=>{const r=O.filter((r,i)=>i!==e),i=_.filter((r,i)=>i!==e);M(r),Y(i)})(r),style:{position:"absolute",top:"0.25rem",right:"0.25rem",background:"#ef4444",color:"white",border:"none",borderRadius:"50%",width:"24px",height:"24px",cursor:"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",transition:"all 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="#dc2626",onMouseLeave:e=>e.currentTarget.style.background="#ef4444",children:"Ã—"})]},r))})]}),s.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end",paddingTop:"1.5rem",borderTop:"1px solid #e5e7eb"},children:[s.jsx("button",{onClick:X,disabled:K,style:{padding:"0.75rem 1.5rem",background:"#f3f4f6",color:"#374151",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",fontWeight:"500",fontSize:"0.875rem",transition:"all 0.2s"},onMouseEnter:e=>!K&&(e.currentTarget.style.background="#e5e7eb"),onMouseLeave:e=>e.currentTarget.style.background="#f3f4f6",children:"Ä°ptal"}),s.jsx("button",{onClick:async()=>{if(R&&B&&B>=1&&5>=B)if(u){if($[R.productId])return j("Bu Ã¼rÃ¼ne zaten yorum yaptÄ±nÄ±z. Her Ã¼rÃ¼ne sadece bir kez yorum yapabilirsiniz."),void X();W(!0),j("");try{if(!u)return j("GiriÅŸ yapmanÄ±z gerekiyor. LÃ¼tfen sayfayÄ± yenileyip tekrar deneyin."),void W(!1);const e=new FormData;e.append("productId",R.productId.toString()),e.append("rating",B.toString()),F.trim()&&e.append("comment",F.trim()),O.forEach((r,i)=>{e.append("images",r)});const r={};u&&(r.Authorization="Bearer "+u);const i=await fetch(d+"/reviews",{method:"POST",headers:r,body:e});if(401===i.status)return p(),j("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n."),X(),void setTimeout(()=>{h("/giris",{state:{returnTo:"/siparis/"+l}})},1500);const s=await i.json();if(!i.ok||!s.isSuccess&&!s.success){const e=s.message||"Yorum eklenirken bir hata oluÅŸtu";throw(e.includes("zaten yorum yaptÄ±nÄ±z")||e.includes("sadece bir kez"))&&G(e=>({...e,[R.productId]:!0})),Error(e)}const t=s.message||"Yorumunuz gÃ¶nderildi. Yorumunuz kÄ±sa sÃ¼re iÃ§inde yayÄ±nlanacaktÄ±r.";I(t),G(e=>({...e,[R.productId]:!0})),X(),setTimeout(()=>{(async e=>{if(e&&u)try{const r=await fetch(`${d}/reviews/product/${e}/has-reviewed`,{headers:{Authorization:"Bearer "+u}});if(r.ok){const i=await r.json();i.isSuccess&&!0===i.data?G(r=>({...r,[e]:!0})):G(r=>{const i={...r};return delete i[e],i})}}catch(r){}})(R.productId)},1500),setTimeout(()=>{H()},2e3)}catch(e){j(e.message||"Yorum eklenirken bir hata oluÅŸtu")}finally{W(!1)}}else j("GiriÅŸ yapmanÄ±z gerekiyor");else j("LÃ¼tfen 1-5 arasÄ± bir puan seÃ§in")},disabled:K||!B,style:{padding:"0.75rem 1.5rem",background:B?"#374151":"#d1d5db",color:"white",border:"none",borderRadius:"8px",cursor:B?"pointer":"not-allowed",fontWeight:"600",fontSize:"0.875rem",transition:"all 0.2s",opacity:K?.6:1},onMouseEnter:e=>{B&&!K&&(e.currentTarget.style.background="#1f2937")},onMouseLeave:e=>{e.currentTarget.style.background=B?"#374151":"#d1d5db"},children:K?s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),"GÃ¶nderiliyor..."]}):"Yorumu GÃ¶nder"})]})]})]})}),k&&s.jsx("div",{className:"modal-overlay",onClick:()=>!S&&v(!1),children:s.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[s.jsx("h3",{children:"Ä°ade Talebi OluÅŸtur"}),s.jsx("p",{children:"Ä°ade talebi oluÅŸturmak istediÄŸinizden emin misiniz? Ä°ade talebiniz deÄŸerlendirildikten sonra size geri dÃ¶nÃ¼ÅŸ yapÄ±lacaktÄ±r."}),s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{htmlFor:"refundReason",children:["Ä°ade Sebebi ",s.jsx("span",{className:"required",children:"*"})]}),s.jsx("textarea",{id:"refundReason",value:N,onChange:e=>E(e.target.value),rows:"4",placeholder:"LÃ¼tfen iade sebebinizi detaylÄ± olarak aÃ§Ä±klayÄ±n...",required:!0})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{onClick:()=>{v(!1),E("Ä°ade talebi"),j("")},disabled:S,className:"cancel-btn",children:"Ä°ptal"}),s.jsx("button",{onClick:async()=>{if(N.trim()){T(!0),j(""),I("");try{const e=await fetch(`${d}/orders/${l}/refund?email=${encodeURIComponent(c.email)}&reason=${encodeURIComponent(N)}`,{method:"POST",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer "+u}}}),r=await e.json();if(!e.ok)throw Error(r.message||"Ä°ade talebi oluÅŸturulamadÄ±");if(!r.isSuccess&&!r.success)throw Error(r.message||"Ä°ade talebi oluÅŸturulamadÄ±");I("Ä°ade talebiniz baÅŸarÄ±yla oluÅŸturuldu. En kÄ±sa sÃ¼rede deÄŸerlendirilecektir."),v(!1),E("Ä°ade talebi"),await H()}catch(e){j(e.message||"Ä°ade talebi oluÅŸturulurken bir hata oluÅŸtu")}finally{T(!1)}}else j("LÃ¼tfen iade sebebini belirtin")},disabled:S||!N.trim(),className:"confirm-btn",children:S?"Ä°ÅŸleniyor...":"Ä°ade Talebi OluÅŸtur"})]})]})})]}):null]}):null;var J};export{l as default};
