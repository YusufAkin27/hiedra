import{u as e,r as s,j as a,L as i}from"./react-vendor-DfawjiNX.js";import{a as r}from"./context-BBxaqZSG.js";import{u as l}from"./index-CWeyrpi3.js";import{S as t}from"./SEO-COBDhSYn.js";import"./vendor-invariant-GfE-dftQ.js";import"./vendor-shallowequal-DDPVF0Lr.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BfCtOoOM.js";const n="http://localhost:8080/api",o=()=>{const{isAuthenticated:o,accessToken:d}=r(),c=e(),m=l(),[h,u]=s.useState({fullName:"",phone:"",addressLine:"",addressDetail:"",city:"",district:"",neighbourhood:"",isDefault:!1}),[p,x]=s.useState(!1),[g,j]=s.useState(""),[y,f]=s.useState(!1);s.useEffect(()=>{o||c("/giris",{state:{from:"/adres-ekle"}})},[o,c]);const k=e=>{const{name:s,value:a,type:i,checked:r}=e.target;u(e=>({...e,[s]:"checkbox"===i?r:a}))};return o?a.jsxs("div",{className:"add-address-page",children:[a.jsx(t,{title:"Yeni Adres Ekle - Hiedra Home Collection",description:"Yeni teslimat adresi ekleyin",url:"/adres-ekle"}),a.jsxs("div",{className:"add-address-container",children:[a.jsxs("div",{className:"add-address-header",children:[a.jsxs(i,{to:"/adreslerim",className:"back-link",children:[a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Adreslerime Dön"]}),a.jsx("h1",{children:"Yeni Adres Ekle"}),a.jsx("p",{className:"page-subtitle",children:"Teslimat için yeni bir adres ekleyin"}),a.jsxs("div",{className:"location-button-container",children:[a.jsx("button",{type:"button",onClick:async()=>{if(navigator.geolocation){f(!0),j("");try{navigator.geolocation.getCurrentPosition(async e=>{const{latitude:s,longitude:a,accuracy:i}=e.coords;i&&i>100&&m.show({title:"Dikkat",message:`Konum hassasiyeti düşük (±${Math.round(i)}m). Daha doğru sonuç için açık alanda tekrar deneyin.`,type:"warning"});try{const e=await fetch(`${n}/geocoding/reverse?latitude=${s}&longitude=${a}`),i=await e.json();if(!(e.ok&&i.success&&i.data))throw Error(i.message||"Adres bilgisi alınamadı");{const e=i.data;u(s=>{let a=e.city||s.city,i=e.district||s.district,r=e.neighbourhood||s.neighbourhood;if(e.displayName){const s=e.displayName.split(",").map(e=>e.trim());if(s.length>=3){if(s[2]&&(a=s[2]),!r&&s[0]){const e=s[0];(e.toLowerCase().includes("mahallesi")||e.toLowerCase().includes("mahalle"))&&(r=e)}if(!i&&s[1]){let e=s[1];a&&e.includes(a)&&(e=e.replace(a,"").trim(),""!==e&&"merkez"!==e.toLowerCase()||(e="Merkez")),i=e}r||!s[0]||s[0].toLowerCase().includes("merkez")||s[0].toLowerCase().includes("bölge")||(r=s[0])}}if(a&&(a.toLowerCase().includes("merkez")&&(a=a.replace(/\s*merkez\s*/i,"").trim()),i&&a.includes(i)&&(a=a.replace(i,"").trim())),i&&a&&i.includes(a)){const e=i.replace(a,"").trim();i=""===e||"merkez"===e.toLowerCase()?"Merkez":e}const l=[];e.road&&l.push(e.road),e.houseNumber&&l.push("No: "+e.houseNumber);let t=s.addressLine;if(l.length>0)t=l.join(", ");else if(e.displayName){const s=e.displayName.split(",");s.length>1&&(t=s[0].trim())}return{...s,city:a,district:i,neighbourhood:r,addressLine:t}}),m.show({title:"Başarılı!",message:"Konumunuzdan adres bilgileri alındı. Lütfen kontrol edin ve gerekirse düzenleyin.",type:"success"})}}catch(r){m.show({title:"Hata",message:"Adres bilgisi alınırken bir hata oluştu. Lütfen manuel olarak girin.",type:"error"})}finally{f(!1)}},e=>{let s="Konum alınamadı.";switch(e.code){case e.PERMISSION_DENIED:s="Konum izni reddedildi. Lütfen tarayıcı ayarlarından konum iznini açın.";break;case e.POSITION_UNAVAILABLE:s="Konum bilgisi alınamadı.";break;case e.TIMEOUT:s="Konum alınırken zaman aşımı oluştu."}m.show({title:"Hata",message:s,type:"error"}),f(!1)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}catch(e){m.show({title:"Hata",message:"Konum servisi kullanılamıyor.",type:"error"}),f(!1)}}else m.show({title:"Hata",message:"Tarayıcınız konum özelliğini desteklemiyor.",type:"error"})},disabled:y,className:"location-button-primary",children:y?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"loading-spinner"}),"Konumunuz alınıyor..."]}):a.jsxs(a.Fragment,{children:[a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),a.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),"Konumumdan Adres Bilgilerini Al"]})}),a.jsx("p",{className:"location-hint",children:"Konum izni vererek adres bilgilerinizi otomatik doldurabilirsiniz"})]})]}),g&&a.jsx("div",{className:"alert alert-error",children:g}),a.jsx("div",{className:"add-address-form-wrapper",children:a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),j(""),x(!0);try{const e=await fetch(n+"/user/addresses",{method:"POST",headers:{Authorization:"Bearer "+d,"Content-Type":"application/json"},body:JSON.stringify({...h})}),s=await e.json();e.ok&&(s.isSuccess||s.success)?(m.show({title:"Başarılı!",message:"Adres başarıyla eklendi.",type:"success"}),c("/adreslerim")):j(s.message||"Adres eklenemedi")}catch(s){j("Adres eklenirken bir hata oluştu")}finally{x(!1)}},className:"add-address-form",children:[a.jsxs("div",{className:"form-section",children:[a.jsx("h2",{className:"form-section-title",children:"Kişi Bilgileri"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"fullName",children:"Ad Soyad *"}),a.jsx("input",{type:"text",id:"fullName",name:"fullName",value:h.fullName,onChange:k,required:!0,placeholder:"Adınız ve soyadınız"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"phone",children:"Telefon *"}),a.jsx("input",{type:"tel",id:"phone",name:"phone",value:h.phone,onChange:k,required:!0,placeholder:"05XX XXX XX XX"})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h2",{className:"form-section-title",children:"Adres Bilgileri"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"addressLine",children:"Sokak / Cadde / Bina No *"}),a.jsx("input",{type:"text",id:"addressLine",name:"addressLine",value:h.addressLine,onChange:k,required:!0,placeholder:"Sokak, cadde ve bina numarası"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"addressDetail",children:"Adres Detayı"}),a.jsx("input",{type:"text",id:"addressDetail",name:"addressDetail",value:h.addressDetail,onChange:k,placeholder:"Daire, kat, blok vb. (opsiyonel)"})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"city",children:"İl *"}),a.jsx("input",{type:"text",id:"city",name:"city",value:h.city,onChange:k,required:!0,placeholder:"İl adı"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"district",children:"İlçe *"}),a.jsx("input",{type:"text",id:"district",name:"district",value:h.district,onChange:k,required:!0,placeholder:"İlçe adı"})]})]}),a.jsx("div",{className:"form-row",children:a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"neighbourhood",children:"Mahalle"}),a.jsx("input",{type:"text",id:"neighbourhood",name:"neighbourhood",value:h.neighbourhood,onChange:k,placeholder:"Mahalle adı (opsiyonel)"})]})})]}),a.jsx("div",{className:"form-section",children:a.jsx("div",{className:"form-group checkbox-group",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",name:"isDefault",checked:h.isDefault,onChange:k}),a.jsx("span",{children:"Varsayılan adres olarak ayarla"})]})})}),a.jsxs("div",{className:"form-actions",children:[a.jsx(i,{to:"/adreslerim",className:"btn-cancel",children:"İptal"}),a.jsx("button",{type:"submit",className:"btn-submit",disabled:p,children:p?"Kaydediliyor...":"Adresi Kaydet"})]})]})})]})]}):null};export{o as default};
