import{u as e,r,j as i,L as s}from"./react-vendor-DfawjiNX.js";import{a}from"./context-BBxaqZSG.js";import{S as t}from"./SEO-COBDhSYn.js";import"./vendor-invariant-GfE-dftQ.js";import"./vendor-shallowequal-DDPVF0Lr.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BfCtOoOM.js";const n="http://localhost:8080/api",o=()=>{const{user:o,isAuthenticated:l,accessToken:d}=a(),c=e(),[m,u]=r.useState([]),[p,h]=r.useState(!0),[b,N]=r.useState(""),[x,g]=r.useState(null),[j,y]=r.useState(!1),[E,f]=r.useState("Ä°ade talebi"),[k,v]=r.useState(""),[S,T]=r.useState({}),[D,C]=r.useState({});r.useEffect(()=>{l?I():c("/giris")},[l,o,d]),r.useEffect(()=>{m.length>0&&o?.email&&m.forEach(e=>{!e.trackingNumber||S[e.orderNumber]||D[e.orderNumber]||z(e)})},[m,o?.email]);const I=async()=>{if(!o?.email)return N("KullanÄ±cÄ± bilgisi bulunamadÄ±"),void h(!1);try{h(!0),N("");const e=await fetch(n+"/orders/my-orders",{method:"GET",headers:{"Content-Type":"application/json",...d&&{Authorization:"Bearer "+d}}});if(!e.ok){if(401===e.status)throw Error("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n.");if(404===e.status)return void u([]);{const r=await e.json().catch(()=>({}));throw Error(r.message||`SipariÅŸler yÃ¼klenemedi (${e.status})`)}}const r=await e.json();if(r.isSuccess||r.success){const e=r.data||[];u(e)}else u([]),N(r.message||"SipariÅŸler yÃ¼klenemedi")}catch(e){N(e.message||"SipariÅŸler yÃ¼klenirken bir hata oluÅŸtu")}finally{h(!1)}},R=e=>{if(!e)return"status-unknown";const r=e.toUpperCase();return"DELIVERED"===r?"status-delivered":"SHIPPED"===r?"status-shipped":"PROCESSING"===r||"PAID"===r?"status-processing":"CANCELLED"===r||"REFUNDED"===r?"status-cancelled":"REFUND_REQUESTED"===r?"status-refund":"status-pending"},w=e=>{if(!e||!e.status)return!1;const r=e.status.toUpperCase();return"REFUNDED"!==r&&"REFUND_REQUESTED"!==r},z=async e=>{if(!e.trackingNumber||!o?.email)return;const r=e.orderNumber;if(!D[r]&&!S[r])try{C(e=>({...e,[r]:!0}));const i=new URL(n+"/shipping/track-by-order");i.searchParams.append("orderNumber",e.orderNumber),i.searchParams.append("email",o.email);const s=await fetch(i.toString(),{method:"GET",headers:{"Content-Type":"application/json",...d&&{Authorization:"Bearer "+d}}}),a=await s.json();(a.isSuccess||a.success)&&T(e=>({...e,[r]:a.data}))}catch(i){}finally{C(e=>({...e,[r]:!1}))}},P=e=>e?{IN_TRANSIT:"Kargoda",DELIVERED:"Teslim Edildi",EXCEPTION:"Sorun Var",PENDING:"Beklemede",PICKED_UP:"Kargo AlÄ±ndÄ±",OUT_FOR_DELIVERY:"Teslimat Ä°Ã§in Yola Ã‡Ä±ktÄ±"}[e.toUpperCase()]||e:"Bilinmiyor";return l?i.jsxs("div",{className:"my-orders-container",children:[i.jsx(t,{title:"SipariÅŸlerim - Hiedra Perde",description:"SipariÅŸlerinizi gÃ¶rÃ¼ntÃ¼leyin ve takip edin",url:"/siparislerim"}),i.jsxs("header",{className:"my-orders-header",children:[i.jsx("h1",{children:"SipariÅŸlerim"}),i.jsx("p",{children:"SipariÅŸlerinizin durumunu takip edebilirsiniz"})]}),b&&!p&&i.jsx("div",{className:"error-message",style:{margin:"1rem",padding:"1rem",backgroundColor:"#fee",color:"#c33",borderRadius:"4px"},children:b}),k&&i.jsx("div",{className:"success-message",style:{margin:"1rem",padding:"1rem",backgroundColor:"#efe",color:"#3c3",borderRadius:"4px"},children:k}),p?i.jsxs("div",{className:"loading-state",children:[i.jsx("div",{className:"loading-spinner"}),i.jsx("p",{children:"SipariÅŸler yÃ¼kleniyor..."})]}):b&&0===m.length?i.jsxs("div",{className:"error-state",children:[i.jsx("p",{children:b}),i.jsx("button",{onClick:I,className:"retry-btn",children:"Tekrar Dene"})]}):0===m.length?i.jsxs("div",{className:"empty-state",children:[i.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M9 2L7 6m6-4l2 4M3 8h18l-1 8H4L3 8z"}),i.jsx("circle",{cx:"7",cy:"20",r:"2"}),i.jsx("circle",{cx:"17",cy:"20",r:"2"})]}),i.jsx("h2",{children:"HenÃ¼z sipariÅŸiniz yok"}),i.jsx("p",{children:"Ä°lk sipariÅŸinizi vermek iÃ§in Ã¼rÃ¼nlerimizi inceleyin"}),i.jsx(s,{to:"/",className:"shop-btn",children:"AlÄ±ÅŸveriÅŸe BaÅŸla"})]}):i.jsx("div",{className:"orders-list",children:m.map(e=>{return i.jsxs("div",{className:"order-card",children:[i.jsxs("div",{className:"order-card-header",children:[i.jsxs("div",{className:"order-info",children:[i.jsxs("h3",{children:["SipariÅŸ No: ",e.orderNumber]}),i.jsx("span",{className:"status-badge "+R(e.status),children:(r=e.status,r?{PENDING:"Beklemede",PAID:"Ã–dendi",PROCESSING:"HazÄ±rlanÄ±yor",SHIPPED:"Kargoya Verildi",DELIVERED:"Teslim Edildi",CANCELLED:"Ä°ptal Edildi",REFUNDED:"Ä°ade Edildi",REFUND_REQUESTED:"Ä°ade Talebi"}[r.toUpperCase()]||r:"Bilinmiyor")})]}),i.jsxs("div",{className:"order-date",children:[i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("circle",{cx:"12",cy:"12",r:"10"}),i.jsx("polyline",{points:"12 6 12 12 16 14"})]}),e.createdAt?new Date(e.createdAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Tarih bilgisi yok"]})]}),i.jsx("div",{className:"order-items-preview",children:e.orderItems&&e.orderItems.length>0?i.jsxs(i.Fragment,{children:[e.orderItems.slice(0,3).map((e,r)=>{const s=e.price?"string"==typeof e.price?parseFloat(e.price):parseFloat(e.price.toString()):0;return i.jsxs("div",{className:"order-item-preview",children:[i.jsx("span",{className:"item-name",children:e.productName||"ÃœrÃ¼n"}),e.width&&e.height&&i.jsxs("span",{className:"item-dimensions",children:["(",e.width," x ",e.height," cm)"]}),e.pleatType&&"1x1"!==e.pleatType&&i.jsxs("span",{className:"item-pleat",children:["Pile: ",e.pleatType]}),i.jsxs("span",{className:"item-quantity",children:["x",e.quantity||1]}),i.jsxs("span",{className:"item-price",children:[s.toFixed(2)," â‚º"]})]},e.id||r)}),e.orderItems.length>3&&i.jsxs("div",{className:"more-items",children:["+",e.orderItems.length-3," Ã¼rÃ¼n daha"]})]}):i.jsx("p",{children:"SipariÅŸ detayÄ± bulunamadÄ±"})}),e.trackingNumber&&i.jsxs("div",{className:"order-tracking-section",style:{padding:"1rem",marginTop:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e0e0e0"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[i.jsxs("div",{children:[i.jsx("strong",{children:"Kargo Takip:"})," ",e.trackingNumber,e.carrier&&i.jsxs("span",{style:{marginLeft:"0.5rem",color:"#64748b"},children:["(",e.carrier,")"]})]}),i.jsx("button",{onClick:()=>z(e),disabled:D[e.orderNumber],style:{padding:"0.25rem 0.75rem",background:"#667eea",color:"white",border:"none",borderRadius:"4px",cursor:D[e.orderNumber]?"not-allowed":"pointer",fontSize:"0.85rem",opacity:D[e.orderNumber]?.6:1},children:D[e.orderNumber]?"YÃ¼kleniyor...":"GÃ¼ncelle"})]}),S[e.orderNumber]?i.jsxs("div",{style:{marginTop:"0.75rem"},children:[i.jsx("div",{style:{display:"inline-block",padding:"0.25rem 0.75rem",borderRadius:"4px",fontSize:"0.9rem",fontWeight:"600",backgroundColor:"DELIVERED"===S[e.orderNumber].status?"#d4edda":"IN_TRANSIT"===S[e.orderNumber].status?"#d1ecf1":"EXCEPTION"===S[e.orderNumber].status?"#f8d7da":"#fff3cd",color:"DELIVERED"===S[e.orderNumber].status?"#155724":"IN_TRANSIT"===S[e.orderNumber].status?"#0c5460":"EXCEPTION"===S[e.orderNumber].status?"#721c24":"#856404"},children:P(S[e.orderNumber].status)}),S[e.orderNumber].statusDescription&&i.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.9rem",color:"#64748b"},children:S[e.orderNumber].statusDescription}),S[e.orderNumber].events&&S[e.orderNumber].events.length>0&&i.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.85rem",color:"#64748b"},children:[i.jsx("strong",{children:"Son Hareket:"})," ",S[e.orderNumber].events[0].description||"Bilgi yok",S[e.orderNumber].events[0].location&&i.jsxs("span",{style:{marginLeft:"0.5rem"},children:["ğŸ“ ",S[e.orderNumber].events[0].location]})]}),i.jsx(s,{to:`/kargo-takip?trackingNumber=${e.trackingNumber}&orderNumber=${e.orderNumber}`,style:{display:"inline-block",marginTop:"0.75rem",color:"#667eea",textDecoration:"none",fontSize:"0.9rem",fontWeight:"600"},children:"â†’ DetaylÄ± Takip Bilgisi"})]}):i.jsx(s,{to:`/kargo-takip?trackingNumber=${e.trackingNumber}&orderNumber=${e.orderNumber}`,style:{display:"inline-block",marginTop:"0.5rem",color:"#667eea",textDecoration:"none",fontSize:"0.9rem",fontWeight:"600"},children:"â†’ Kargo Durumunu GÃ¶rÃ¼ntÃ¼le"})]}),i.jsxs("div",{className:"order-card-footer",children:[i.jsxs("div",{className:"order-total",children:[i.jsx("span",{children:"Toplam:"}),i.jsxs("span",{className:"total-amount",children:[e.totalAmount?"string"==typeof e.totalAmount?parseFloat(e.totalAmount).toFixed(2):parseFloat(e.totalAmount.toString()).toFixed(2):"0.00"," â‚º"]})]}),i.jsxs("div",{className:"order-actions",children:[w(e)&&i.jsx("button",{onClick:()=>{g(e),y(!0),N(""),v("")},className:"refund-btn",disabled:x&&x.orderNumber===e.orderNumber,children:x&&x.orderNumber===e.orderNumber?"Ä°ÅŸleniyor...":"Ä°ade Talebi"}),i.jsx(s,{to:"/siparis/"+e.orderNumber,className:"view-order-btn",children:"DetaylarÄ± GÃ¶r"})]})]})]},e.id||e.orderNumber);var r})}),j&&x&&i.jsx("div",{className:"modal-overlay",onClick:()=>{y(!1),f("Ä°ade talebi"),N(""),g(null)},children:i.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[i.jsx("h3",{children:"Ä°ade Talebi OluÅŸtur"}),i.jsxs("p",{children:["SipariÅŸ No: ",x.orderNumber]}),i.jsx("p",{children:"Ä°ade talebi oluÅŸturmak istediÄŸinizden emin misiniz? Ä°ade talebiniz deÄŸerlendirildikten sonra size geri dÃ¶nÃ¼ÅŸ yapÄ±lacaktÄ±r."}),b&&i.jsx("div",{className:"error-message",style:{marginTop:"1rem"},children:b}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"refundReason",children:["Ä°ade Sebebi ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("textarea",{id:"refundReason",value:E,onChange:e=>f(e.target.value),rows:"4",placeholder:"LÃ¼tfen iade sebebinizi detaylÄ± olarak aÃ§Ä±klayÄ±n...",required:!0})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{onClick:()=>{y(!1),f("Ä°ade talebi"),N(""),g(null)},className:"cancel-btn",children:"Ä°ptal"}),i.jsx("button",{onClick:async()=>{if(!E.trim())return void N("LÃ¼tfen iade sebebini belirtin");if(!x||!x.orderNumber)return void N("SipariÅŸ bilgisi bulunamadÄ±");const e=x.orderNumber;N(""),v("");try{const r=await fetch(`${n}/orders/${e}/refund?email=${encodeURIComponent(o.email)}&reason=${encodeURIComponent(E)}`,{method:"POST",headers:{"Content-Type":"application/json",...d&&{Authorization:"Bearer "+d}}}),i=await r.json();if(!r.ok)throw Error(i.message||"Ä°ade talebi oluÅŸturulamadÄ±");if(!i.isSuccess&&!i.success)throw Error(i.message||"Ä°ade talebi oluÅŸturulamadÄ±");v("Ä°ade talebiniz baÅŸarÄ±yla oluÅŸturuldu. En kÄ±sa sÃ¼rede deÄŸerlendirilecektir."),y(!1),f("Ä°ade talebi"),g(null),await I()}catch(r){N(r.message||"Ä°ade talebi oluÅŸturulurken bir hata oluÅŸtu")}},disabled:!E.trim(),className:"confirm-btn",children:"Ä°ade Talebi OluÅŸtur"})]})]})})]}):null};export{o as default};
